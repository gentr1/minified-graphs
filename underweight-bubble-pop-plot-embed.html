
<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Country Prevalence - Obesity > Adiposity > Data Visualisations > NCD-RisC</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="css/themify-icons.css" rel="stylesheet" type="text/css" media="all" />
        <link href="css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
        <link href="css/flexslider.css" rel="stylesheet" type="text/css" media="all" />
        <link href="css/lightbox.min.css" rel="stylesheet" type="text/css" media="all" />
        <link href="css/theme-chipotle.css" rel="stylesheet" type="text/css" media="all" />
        <link href="css/custom.css" rel="stylesheet" type="text/css" media="all" />
        <link href="css/3d-ncd.css" rel="stylesheet" type="text/css" media="all" />
        <link href='http://fonts.googleapis.com/css?family=Lato:300,400%7CRaleway:100,400,300,500,600,700%7COpen+Sans:400,500,600' rel='stylesheet' type='text/css'>
        <link href="http://fonts.googleapis.com/css?family=Open+Sans:100,300,400,600,700" rel="stylesheet" type="text/css">
        <link href="css/font-opensans.css" rel="stylesheet" type="text/css">
		<link href="css/jquery-ui.min.css" rel="stylesheet" type="text/css" media="all" />
		<link rel="stylesheet" href="css/nouislider.min.css" />
		
		<style>
		.mys{
			-webkit-appearance: none;
			transform: translate(0px, 9px);
			font-size: 16px;
			font-weight: normal;
			color:#6f828e;
			font-size: 11px;
			border-radius: 0;
			z-index: 1000;
			//border: none;
			border: 1px solid #DDDDDD;
			background: transparent;
			//width: 380px;
			//overflow: hidden;
			padding-top: 0px;
			//height: 70px;
			//text-indent: 10px;
			//color: #ffffff;
			
		}
		
		
		.switch2 {
			position: relative;
			display: block;
			vertical-align: top;
			width: 100px;
			height: 28px;
			padding: 0px;
			margin: 0 0px 0px 0;
			background: linear-gradient(to bottom, #eeeeee, #FFFFFF 25px);
			background-image: -webkit-linear-gradient(top, #eeeeee, #FFFFFF 25px);
			border-radius: 18px;
			box-shadow: inset 0 -1px white, inset 0 1px 1px rgba(0, 0, 0, 0.05);
			cursor: pointer;
		}
		.switch2-input {
			position: absolute;
			top: 0;
			left: 0;
			opacity: 0;
		}
		.switch2-label {
			position: relative;
			display: block;
			height: inherit;
			font-size: 10px;
			//text-transform: uppercase;
			background: #eceeef;
			border-radius: inherit;
			box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.12), inset 0 0 2px rgba(0, 0, 0, 0.15);
		}
		.switch2-label:before, .switch2-label:after {
			position: absolute;
			top: 50%;
			margin-top: -.5em;
			line-height: 1;
			-webkit-transition: inherit;
			-moz-transition: inherit;
			-o-transition: inherit;
			transition: inherit;
		}
		.switch2-label:before {
			content: attr(data-off);
			right: 11px;
			color: #aaaaaa;
			text-shadow: 0 1px rgba(255, 255, 255, 0.5);
		}
		.switch2-label:after {
			content: attr(data-on);
			left: 11px;
			color: #FFFFFF;
			text-shadow: 0 1px rgba(0, 0, 0, 0.2);
			opacity: 0;
		}
		.switch2-input:checked ~ .switch2-label {
			background: #E1B42B;
			box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.15), inset 0 0 3px rgba(0, 0, 0, 0.2);
		}
		.switch2-input:checked ~ .switch2-label:before {
			opacity: 0;
		}
		.switch2-input:checked ~ .switch2-label:after {
			opacity: 1;
		}
		.switch2-handle {
			position: absolute;
			top: 4px;
			left: 4px;
			width: 28px;
			height: 28px;
			background: linear-gradient(to bottom, #FFFFFF 40%, #f0f0f0);
			background-image: -webkit-linear-gradient(top, #FFFFFF 40%, #f0f0f0);
			border-radius: 100%;
			box-shadow: 1px 1px 5px rgba(0, 0, 0, 0.2);
		}
		.switch2-handle:before {
			content: "";
			position: absolute;
			top: 50%;
			left: 50%;
			margin: -6px 0 0 -6px;
			width: 12px;
			height: 12px;
			background: linear-gradient(to bottom, #eeeeee, #FFFFFF);
			background-image: -webkit-linear-gradient(top, #eeeeee, #FFFFFF);
			border-radius: 6px;
			box-shadow: inset 0 1px rgba(0, 0, 0, 0.02);
		}
		.switch2-input:checked ~ .switch2-handle {
			left: 74px;
			box-shadow: -1px 1px 5px rgba(0, 0, 0, 0.2);
		}
		 
		/* Transition
		========================== */
		.switch2-label, .switch2-handle {
			transition: All 0.3s ease;
			-webkit-transition: All 0.3s ease;
			-moz-transition: All 0.3s ease;
			-o-transition: All 0.3s ease;
		}

		.switch-slide2 {
			padding: 0;
			margin: 3px 3px 3px 3px;
			background: #FFF;
			border-radius: 0;
			background-image: none;
		}
		.switch-slide2 .switch2-label {
			box-shadow: none;
			background: none;
			overflow: hidden;
		}
		.switch-slide2 .switch2-label:after, .switch-slide2 .switch2-label:before {
			width: 100%;
			height: 100%;
			top: 5px;
			left: 0;
			text-align: center;
			padding-top: 10%;
			box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.2), inset 0 0 3px rgba(0, 0, 0, 0.1);
		}
		.switch-slide2 .switch2-label:after {
			color: #000000;
			//background: #87CEEB;
			background: #A9F5A9;//#eceeef;
			left: -100px;
		}
		.switch-slide2 .switch2-label:before {
			background: #eceeef;
		}
		.switch-slide2 .switch2-handle {
			display: none;
		}
		.switch-slide2 .switch2-input:checked ~ .switch2-label {
			background: #FFF;
			border-color: #0088cc;
		}
		.switch-slide2 .switch2-input:checked ~ .switch2-label:before {
			left: 100px;
		}
		.switch-slide2 .switch2-input:checked ~ .switch2-label:after {
			left: 0;
		}






		.switch {
			position: relative;
			display: block;
			vertical-align: top;
			width: 80px;
			height: 28px;
			padding: 0px;
			margin: 0 0px 0px 0;
			background: linear-gradient(to bottom, #eeeeee, #FFFFFF 25px);
			background-image: -webkit-linear-gradient(top, #eeeeee, #FFFFFF 25px);
			border-radius: 18px;
			box-shadow: inset 0 -1px white, inset 0 1px 1px rgba(0, 0, 0, 0.05);
			cursor: pointer;
		}
		.switch-input {
			position: absolute;
			top: 0;
			left: 0;
			opacity: 0;
		}
		.switch-label {
			position: relative;
			display: block;
			height: inherit;
			font-size: 12px;
			//text-transform: uppercase;
			background: #eceeef;
			border-radius: inherit;
			box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.12), inset 0 0 2px rgba(0, 0, 0, 0.15);
		}
		.switch-label:before, .switch-label:after {
			position: absolute;
			top: 50%;
			margin-top: -.5em;
			line-height: 1;
			-webkit-transition: inherit;
			-moz-transition: inherit;
			-o-transition: inherit;
			transition: inherit;
		}
		.switch-label:before {
			content: attr(data-off);
			right: 11px;
			color: #000000;
			text-shadow: 0 1px rgba(255, 255, 255, 0.5);
		}
		.switch-label:after {
			content: attr(data-on);
			left: 11px;
			color: #000000;
			text-shadow: 0 1px rgba(0, 0, 0, 0.2);
			opacity: 0;
		}
		.switch-input:checked ~ .switch-label {
			background: #E1B42B;
			box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.15), inset 0 0 3px rgba(0, 0, 0, 0.2);
		}
		.switch-input:checked ~ .switch-label:before {
			opacity: 0;
		}
		.switch-input:checked ~ .switch-label:after {
			opacity: 1;
		}
		.switch-handle {
			position: absolute;
			top: 4px;
			left: 4px;
			width: 28px;
			height: 28px;
			background: linear-gradient(to bottom, #FFFFFF 40%, #f0f0f0);
			background-image: -webkit-linear-gradient(top, #FFFFFF 40%, #f0f0f0);
			border-radius: 100%;
			box-shadow: 1px 1px 5px rgba(0, 0, 0, 0.2);
		}
		.switch-handle:before {
			content: "";
			position: absolute;
			top: 50%;
			left: 50%;
			margin: -6px 0 0 -6px;
			width: 12px;
			height: 12px;
			background: linear-gradient(to bottom, #eeeeee, #FFFFFF);
			background-image: -webkit-linear-gradient(top, #eeeeee, #FFFFFF);
			border-radius: 6px;
			box-shadow: inset 0 1px rgba(0, 0, 0, 0.02);
		}
		.switch-input:checked ~ .switch-handle {
			left: 74px;
			box-shadow: -1px 1px 5px rgba(0, 0, 0, 0.2);
		}
		 
		/* Transition
		========================== */
		.switch-label, .switch-handle {
			transition: All 0.3s ease;
			-webkit-transition: All 0.3s ease;
			-moz-transition: All 0.3s ease;
			-o-transition: All 0.3s ease;
		}


		.switch-yes-no {
			padding: 0;
			margin: 15px 0 0;
			background: #FFF;
			border-radius: 0;
			background-image: none;
		}
		.switch-yes-no .switch-label {
			box-shadow: none;
			background: none;
		}
		.switch-yes-no .switch-label:after, .switch-yes-no .switch-label:before {
			width: 100%;
			height: 70%;
			top: 5px;
			left: 0;
			text-align: center;
			padding-top: 10%;
			box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.2), inset 0 0 3px rgba(0, 0, 0, 0.1);
		}
		.switch-yes-no .switch-label:after {
			color: #FFFFFF;
			background: #32CD32;
			backface-visibility: hidden;
			transform: rotateY(180deg);
		}
		.switch-yes-no .switch-label:before {
			background: #eceeef;
			backface-visibility: hidden;
		}
		.switch-yes-no .switch-handle {
			display: none;
		}
		.switch-yes-no .switch-input:checked ~ .switch-label {
			background: #FFF;
			border-color: #0088cc;
		}
		.switch-yes-no .switch-input:checked ~ .switch-label:before {
			transform: rotateY(180deg)
		}
		.switch-yes-no .switch-input:checked ~ .switch-label:after {
			transform: rotateY(0)
		}


		.switch-slide {
			padding: 0;
			margin: 5px 0 0;
			background: #FFF;
			border-radius: 0;
			background-image: none;
		}
		.switch-slide .switch-label {
			box-shadow: none;
			background: none;
			overflow: hidden;
		}
		.switch-slide .switch-label:after, .switch-slide .switch-label:before {
			width: 100%;
			height: 100%;
			top: 5px;
			left: 0;
			text-align: center;
			padding-top: 10%;
			box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.2), inset 0 0 3px rgba(0, 0, 0, 0.1);
		}
		.switch-slide .switch-label:after {
			color: #000000;
			//background: #87CEEB;
			background: #eceeef;
			left: -100px;
		}
		.switch-slide .switch-label:before {
			background: #eceeef;
		}
		.switch-slide .switch-handle {
			display: none;
		}
		.switch-slide .switch-input:checked ~ .switch-label {
			background: #FFF;
			border-color: #0088cc;
		}
		.switch-slide .switch-input:checked ~ .switch-label:before {
			left: 100px;
		}
		.switch-slide .switch-input:checked ~ .switch-label:after {
			left: 0;
		}

		#slidertext{
			//position:absolute;
			font-size: 31px;
			font-weight: bold;
			color:#c8c8c8;//#707070;
			transform: translate(-80px, 0px);
			-webkit-transform: translate(0px, 0px);
			-moz-transform: translate(0px, 0px);
			-o-transform: translate(0px, 0px);
			-ms-transform: translate(0px, 0px);
		}
		#graph-container {
			//margin:10px;
			border:0;
			//border-radius: 5px;
			//width:80%;
			//overflow:hidden;
			background: #ffffff;
			//box-shadow: 2px 2px 2px 0px #a6a6a6; 
		}
		.hidden { 
			display: none; 
		}
		div.tooltip {
			color: #222; 
			background: #fff; 
			padding: .1em; 
			text-shadow: #f5f5f5 0 1px 0;
			border-radius: 2px; 
			box-shadow: 0px 0px 2px 0px #a6a6a6; 
			opacity: 0.9; 
			position: absolute;
			font-size: small;
			line-height: 100%;
			z-index:9000;
			width:150px;
		}
		.bbt{
			font-size: small;
			font-weight: normal;
		}	

		.bbt2{
			font-size: small;
			font-weight: normal;
		}	  
		#grby {color:#aaa;padding:0;padding-right:5px;border:1px solid #eee}
		
		#grby2 {color:#aaa;padding:0;padding-right:5px;border:1px solid #eee
		transform: translate(0px, 32px);
			-webkit-transform: translate(0px, 32px);
			-moz-transform: translate(0px, 32px);
			-o-transform: translate(0px, 32px);
			-ms-transform: translate(0px, 32px);
		}
		
		#playpause { 
			 //display:block; 
			 height:32px; width:32px; /* dimensions of the image */
			 //background-repeat:no-repeat;
			 cursor:pointer;
			 //align="middle"
			 transform: translate(0px, -2px);
			-webkit-transform: translate(0px, -2px);
			-moz-transform: translate(0px, -2px);
			-o-transform: translate(0px, -2px);
			-ms-transform: translate(0px, -2px);
		}
		#playpause.play { 
			background-image:url("img2/play2-pause32.png");
			display: block;
		   
			width: 32px;
			height:  32px;
			margin: -1.5px 0;
			//align="middle"
		}

		#playpause.pause { 
			background-image:url("img2/play-pause32.png");
			display: block;
			
			width: 32px;
			height:  32px;
			margin: -1.5px 0;
			//align="middle"
		}
		.axis path,
		.axis line {
		  fill: none;
		  stroke: #000;
		  shape-rendering: crispEdges;
		}
		circle {
        stroke: black;
        stroke-width: 1px;
        opacity: .8;
      }
		.normal{
			stroke-width: 1px;
			stroke: black;
		}
		.unselected-underlined {
			stroke-width: 3px;
			stroke: black;
		}
		.underlined{
			stroke-width: 3px;
			stroke: red;
		}
		.label {
				fill: white;
				font-size: 16px;
			  }

		.behind{
			z-index:-1000;
			pointer-events: none;
		}
		.axis text {
		//font-family: sans-serif;
			font-size: 14px;
		}
		fieldset.scheduler-border {
			border: 1px solid #eee !important;
			padding: 0 0.4em 0.4em 0.4em !important;
			margin: 0 0 0.1em 0 !important;height:44px;
			-webkit-box-shadow:  0px 0px 0px 0px #000;
					box-shadow:  0px 0px 0px 0px #000;
			color:#aaa;		
		}

			legend.scheduler-border {
				font-size: 1.0em !important;
				font-weight: light !important;
				//text-align: left !important;
				width:auto;
				padding:0 1px;
				border-bottom:none;color:#aaa;
			}
			.upward {
			transform: translate(0px, -25px);
			-webkit-transform: translate(0px, -25px);
			-moz-transform: translate(0px, -25px);
			-o-transform: translate(0px, -25px);
			-ms-transform: translate(0px, -25px);
			}
			.rightward {
			transform: translate(25px, 0px);
			-webkit-transform: translate(25px, 0px);
			-moz-transform: translate(25px, 0px);
			-o-transform: translate(25px, 0px);
			-ms-transform: translate(25px, 0px);
			}
			.leftward2 {
			transform: translate(-10px, 0px);
			-webkit-transform: translate(-10px, 0px);
			-moz-transform: translate(-10px, 0px);
			-o-transform: translate(-10px, 0px);
			-ms-transform: translate(-10px, 0px);
			}
			
			.noUi-horizontal.noUi-extended {
				padding-right: 32px;
			}
			.noUi-horizontal.noUi-extended .noUi-handle {
				left: -1px;
			}
			.noUi-horizontal.noUi-extended .noUi-origin  {
				right: -32px;
			}
			
			//td {border: 1px solid #eee;}
			
		</style>
		


		
       </head>
    <body>
		
		<table>
			<tr>
				<td>
					<label  class="switch2 switch-slide2" id ="var-col"  style="float:left;" >
						<input class="switch2-input" type="checkbox" id="selectColor"/>
						<span class="switch2-label" data-on="Colour-blind friendly" data-off="Colour-blind friendly"></span> 
						<span class="switch2-handle"></span>
					</label>
				</td>
				<td align="center">
					<div id="slidertext" style="pointer-events: none;">2014</div>
					<select id="x1" name="axis1" style="position:absolute;width:220px;font-size:10px;color:#000;box-shadow: 0px 0px 2px 0px #a6a6a6; height:30px;opacity:0.8;">
						<option value="gdp" selected>Per-capita GDP</option> 
						<option value="edu">Average years of education</option>
						<option value="urb">% living in cities</option>
					</select>
				</td>
				<td>
					<label class="switch switch-slide leftward2"  id ="var-pop" style="float:right">
						<input class="switch-input" type="checkbox" id="selectGender"  />
						<span class="switch-label" data-on="Men" data-off="Women"></span> 
						<span class="switch-handle"></span>
					</label>
					
				</td>
			</tr>
			
			<tr>
				<td colspan="3">
					<div id="per" style="font-size:20px;font-weight: bold;color:#993300;position:absolute;width:200px;" >&nbsp;</div>
					<div id="popcenter" style="z-index:4000;font-size:20px;font-weight: bold;color:#000000;position:absolute"  >&nbsp;</div>
					<div id="graph-container"  ></div>
				</td>
			</tr>
			<tr>
				<td colspan="3">
					<br>
					<div id="playpause" class="play" style="float:left;"></div>
					<div style="float:right;pointer-events: none;-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;-o-user-select: none;user-select: none;">&nbsp;&nbsp;&nbsp;</div>
					<div id="red" class="noUi-extended" style="float:left;"></div>
					<div id="optsb" style="position:absolute">
					<fieldset id="grby2" class="scheduler-border" >
						<legend class="scheduler-border">Colour scale</legend>
													
						<div class="btn-group upward"  data-toggle="buttons" style="float:right;"> 
							<label class="bbt2" id="c1">
								<input type="radio" name="options2" checked> Region
							</label>
							<label class="bbt2" id="c2">
								<input type="radio" name="options2"> Education
							</label>
							<label class="bbt2" id="c3">
								<input type="radio" name="options2"> % living in cities
							</label>
							<label class="bbt2" id="c4">
								<input type="radio" name="options2"> Per-capita GDP
							</label>
						</div>
						</fieldset>	
						</div>
				</td>
				
			</tr>
			
		</table>
		 
		<div>
							
		
			
		
			
		<label class="switch switch-slide"  id ="var-graph" style="float:left;width:1px">
									<input class="switch-input" type="checkbox" id="selectGraph"/>
									<span class="switch-label" data-on="Prevalence" data-off="Numbers"></span> 
									<span class="switch-handle"></span>
								</label>	
					
		</div>
			
		<script src="js/jquery.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/flexslider.min.js"></script>
        <script src="js/lightbox.min.js"></script>
        <script src="js/masonry.min.js"></script>
        <script src="js/smooth-scroll.min.js"></script>
        <script src="js/parallax.js"></script>
        <script src="js/scripts.js"></script>

        <script type="text/javascript" src="js2/colorbar.js"></script>
		<script src="js2/jquery-ui.min.js"></script>
        <script src="js2/colorbrewer.js"></script> 
        <script src="js2/d3.min.js" charset="utf-8"></script>
        <script src="js2/d3-legend.min.js"></script>
        <script src="js2/d3.geo.projection.min.js"></script>
        <script src="js2/topojson.min.js"></script>
		<script src="js2/underscore-min.js"></script>
		<script src="js2/nouislider.min.js"></script>
	<script>


var slider = document.getElementById('red');
	noUiSlider.create(slider, {
		start: [2014],
		connect: 'lower',
		step: 1,
		range: {
			'min': 1975,
			'max': 2014
		}//,
		//tooltips: [  wNumb({ decimals: 0 }), wNumb({ decimals: 0 }) ],
	});
  
var listOptions=[];
function is_touch_device() {
    return !!('ontouchstart' in window);
 }
 
// function getSelectedOptions(sel) {
			// listOptions=[];
			  // var opts = [],
				// opt;
			  // var len = sel.options.length;
			  // for (var i = 0; i < len; i++) {
				// opt = sel.options[i];

				// if (opt.selected) {
				  // opts.push(opt);
				  // listOptions.push(opt.text)
				  
				// }
			  // }
			  // console.log(listOptions)
			
			// return opts;
		// } 
function detectIE() {
  var ua = window.navigator.userAgent;

  // Test values; Uncomment to check result …

  // IE 10
  // ua = 'Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)';
  
  // IE 11
  // ua = 'Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko';
  
  // IE 12 / Spartan
  // ua = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.71 Safari/537.36 Edge/12.0';
  
  // Edge (IE 12+)
  // ua = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2486.0 Safari/537.36 Edge/13.10586';

  var msie = ua.indexOf('MSIE ');
  if (msie > 0) {
    // IE 10 or older => return version number
    return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);
  }

  var trident = ua.indexOf('Trident/');
  if (trident > 0) {
    // IE 11 => return version number
    var rv = ua.indexOf('rv:');
    return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);
  }

  var edge = ua.indexOf('Edge/');
  if (edge > 0) {
    // Edge (IE 12+) => return version number
    return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);
  }

  // other browser
  return false;
}


//var nAgt = window.navigator.userAgent;
var isIE = detectIE(); 
//d3.select(window).on("resize", throttle);
var duration = 10000;
var zoom = d3.behavior.zoom()
    .scaleExtent([1, 9])
    .on("zoom", move);
var scalezoom=1.0;
var highlightedcountry=-1;
var s_g =  document.getElementById("selectGraph").checked=false;
var  width = 630;//width = ((window.innerWidth*0.99)-261);//document.getElementById('graph-container').offsetWidth;
//console.log($('#end1').height())
//console.log($('#end2').height())
var height=width*0.6;//(window.innerHeight-(document.getElementById('graph-container').style.top)-60);//(window.innerHeight*0.6);
//if (height>(window.innerHeight*0.55)){
//
//	height = (window.innerHeight*0.72);
//	width = height*2;
	
//}

//document.getElementById('slidertext').style.left=((150+width-30))+"px";
//document.getElementById('slidertext').style.top=(($( "#graph-container" ).position().top)+(height/2.0)-20)+"px";
//d3.select("#slidertext").style("dy","20px");
//document.getElementById('slidertext').style.top=((height*0.5))+"px";
var topo,projection,path,svg,mg;
//var graticule = d3.geo.graticule();
var selected_country="";
var tooltip = d3.select("#graph-container").append("div").attr("class", "tooltip hidden");
//document.getElementById('myinfo').style.opacity=0;
document.getElementById('red').style.width=((width*0.9))+"px";
//document.getElementById('optlist').style.height=(height/2)+"px";
//document.getElementById('imagesbar').style.height=height+"px";
document.getElementById('var-graph').style.opacity=0;
document.getElementById('var-graph').style.visibility="hidden";
var cg;

var selectedMode="all";
var mycenters;
var selectedColorMode="c1";
var c2gradient="url(#gradient1)";
var c3gradient="url(#gradient2)";
var c4gradient="url(#gradient1)";

var formatPop = d3.format(".2s");
var formatGDP = d3.format("$.2s");
var formatPer = d3.format(",.1%");
var formatPer0 = d3.format(",%")
d3.json("json/countries-data.json", function(error, data0) {

	//d3.json("covariates_country_data.json", function(error, mdata) {
		d3.json("json/mini-country-underweight-pop-prev-cov.json", function(error, mdata2) {
	//		d3.json("mini-country-underweight-prevalence.json", function(error, mdata3) {
		
		
				var data =[];
				for (country in mdata2){
					if (country !="Country"){
						var tmp=[];
						for (var i=0;i<mdata2[country][0].length;i++){
							tmp.push({year:parseInt(mdata2[country][0][i][0]), urb:parseFloat(mdata2[country][0][i][8]),gdp:parseFloat(mdata2[country][0][i][9]),edu:parseFloat(mdata2[country][0][i][7]), 
									men: [parseFloat(mdata2[country][0][i][4]),parseFloat(mdata2[country][0][i][1]),parseFloat(mdata2[country][0][i][2]),parseFloat(mdata2[country][0][i][3]),parseFloat(mdata2[country][0][i][5]),parseFloat(mdata2[country][0][i][6])], 
									women: [parseFloat(mdata2[country][1][i][4]),parseFloat(mdata2[country][1][i][1]),parseFloat(mdata2[country][1][i][2]),parseFloat(mdata2[country][1][i][3]),parseFloat(mdata2[country][1][i][5]),parseFloat(mdata2[country][1][i][6])]})
						}
						if (tmp){
							data.push({name:country, region:data0[country][2], timedata:tmp, all:"all"})
						}
					}
				}
				var l_countries={};
				for (elem in data0){
					if (data0.hasOwnProperty(elem)){
						l_countries[data0[elem][0]]=elem ;
					}
					
				}
				var listCountries=[];
				for (elem in mdata2){
					listCountries.push(elem)
				}
				listCountries.sort();	
				
				$('#optlist').empty();
				$.each(listCountries, function(i, p) {
					$('#optlist').append($('<option></option>').val(p).html(p));
				});
				var opts = $('#optlist option').map(function(){
					return [[this.value, $(this).text()]];
				});
				
				
					
				
				
				if (isIE){
					$('#optlist option').click(function (e){
						console.log("ok")
						e.preventDefault();
						var scroll_offset= this.parentElement.scrollTop;

						if (!($(this).prop('selected'))){
							listOptions.push($(this).prop('text'));
							
						}
						else{
							var index = listOptions.indexOf($(this).prop('text'));
							if (index > -1) {
								listOptions.splice(index, 1);
							}
						}
						//console.log($(this).prop('selected'))
						$(this).prop('selected',!$(this).prop('selected'));
						this.parentElement.scrollTop= scroll_offset;
						
						$(this).focus();
						refreshG();
						
						//return false;
					}).mousemove(function(e){e.preventDefault()});;
				}
				else{
					$('#optlist option').mousedown(function (e){
						//console.log("ok")
						e.preventDefault();
						var scroll_offset= this.parentElement.scrollTop;

						if (!($(this).prop('selected'))){
							listOptions.push($(this).prop('text'));
							
						}
						else{
							var index = listOptions.indexOf($(this).prop('text'));
							if (index > -1) {
								listOptions.splice(index, 1);
							}
						}
						//console.log($(this).prop('selected'))
						$(this).prop('selected',!$(this).prop('selected'));
						this.parentElement.scrollTop= scroll_offset;
						
						$(this).focus();
						refreshG();
						
						//return false;
					}).mousemove(function(e){e.preventDefault()});;
				}
				
				$('#someinput').keyup(function(){
					//listOptions=getv();
					//console.log(listOptions)
					var rxp = new RegExp($('#someinput').val(), 'i');
					var optlist = $('#optlist').empty();
					opts.each(function(){
						if (rxp.test(this[1])) {
							if(listOptions.indexOf(this[1])>-1){
								//console.log(this[1])
								optlist.append($('<option/>').attr('value', this[0]).text(this[1]).attr('selected','selected'));
							}
							else{
								optlist.append($('<option/>').attr('value', this[0]).text(this[1]));
							}
						}
					});
					$('#optlist option').mousedown(function (e){
						e.preventDefault();
						var scroll_offset= this.parentElement.scrollTop;

						if (!($(this).prop('selected'))){
							listOptions.push($(this).prop('text'));
							
						}
						else{
							var index = listOptions.indexOf($(this).prop('text'));
							if (index > -1) {
								listOptions.splice(index, 1);
							}
						}
						//console.log($(this).prop('selected'))
						$(this).prop('selected',!$(this).prop('selected'));
						this.parentElement.scrollTop= scroll_offset;

						$(this).focus();
						refreshG();
						//return false;
					}).mousemove(function(e){e.preventDefault()});
				  
				});
				
				var check_g = document.getElementById("selectGender").checked;
				var check_y = parseInt(slider.noUiSlider.get())
					
				var offsetL = document.getElementById('graph-container').offsetLeft+20;
				var offsetT = document.getElementById('graph-container').offsetTop-60;
				
				// start adding figure to svg here////////////////////////
				// get range min and max of all men data
				var range_men=[1000000000,0];
				for (elem in data){
					for (elem2 in data[elem]['timedata']){
					 if(data[elem]['timedata'][elem2]['year']==check_y){
						 
						if (data[elem]['timedata'][elem2].hasOwnProperty('men')){
							
								if (data[elem]['timedata'][elem2]['men'][1]<range_men[0]){
									range_men[0]=data[elem]['timedata'][elem2]['men'][1];
								}
								if (data[elem]['timedata'][elem2]['men'][1]>range_men[1]){
									range_men[1]=data[elem]['timedata'][elem2]['men'][1];
								}
							
						}
						}
					}
				}
				//console.log(range_men)
				// get range min and max of all women data
				var range_women=[1000000000,0];
				for (elem in data){
					for (elem2 in data[elem]['timedata']){
						if(data[elem]['timedata'][elem2]['year']==check_y){
						if (data[elem]['timedata'][elem2].hasOwnProperty('women')){
							
								if (data[elem]['timedata'][elem2]['women'][1]<range_women[0]){
									range_women[0]=data[elem]['timedata'][elem2]['women'][1];
								}
								if (data[elem]['timedata'][elem2]['women'][0]>range_women[1]){
									range_women[1]=data[elem]['timedata'][elem2]['women'][1];
								}
							
						}
						}
					}
					
				}
				var max_amount;
				if (check_g==true){
					max_amount=range_women[1];
				}
				else{
					max_amount=	range_men[1];
				}				
				var radius_scale = d3.scale.linear().domain([0, max_amount]).range([2,  2+(Math.min(width,height)/8)]);//d3.scale.pow(1).domain([0, max_amount]).range([2, 2+(Math.min(width,height)/5)]);//d3.scale.pow(0.5).domain([0, max_amount]).range([2, 75])
				
				var	listMRegions=["Sub-Saharan Africa","Central Asia, Middle East and North Africa","South Asia","East and South East Asia","High-income Asia Pacific","Oceania","Latin America and Caribbean","High−income Western countries","Central and Eastern Europe"];
				var map_region_color={"Sub-Saharan Africa":'#f69999',"Central Asia, Middle East and North Africa": '#e31e26',"South Asia": '#fdbf6e',"East and South East Asia": '#f58022',"High-income Asia Pacific": '#b05828',"Oceania": '#6a3f97',"Latin America and Caribbean": '#2da147',"High-income Western countries": '#a6cfe4' ,"Central and Eastern Europe": '#1779b3'}
				
				//console.log(radius_scale(20000000))
				var all_center = { "all": {name:"all", x: (width/2), y: (height/2)}};
				var mcolor = d3.scale.ordinal().range(['#f69999' , '#e31e26', '#fdbf6e', '#f58022', '#b05828', '#6a3f97', '#2da147', '#a6cfe4' , '#1779b3']).domain(listMRegions);
				
				
				//d3.scale.category20();
				var regioncolor = d3.scale.ordinal().range(['#f69999' , '#e31e26', '#fdbf6e', '#f58022', '#b05828', '#6a3f97', '#2da147', '#a6cfe4' , '#1779b3']).domain(listMRegions);//d3.scale.category20();
				var range_c=d3.scale.linear().domain([0.0,0.25, 0.5]).range(["green","#fee08b","red"]);//"#fee08b","red" ]);
				var range_c2=d3.scale.linear().domain([0.0,10.0, 20.0]).range(["red","#fee08b","green"]);//"#fee08b","red" ]);
				var range_c3=d3.scale.linear().domain([0.0,0.5,1.0]).range(["blue","#fee08b","red"]);//"#fee08b","red" ]);
				var range_c4=d3.scale.linear().domain([200,20000, 200000]).range(["red","#fee08b","green"]);//"#fee08b","red" ]);
				//range_c2=d3.scale.linear().domain([0.0,10.0, 20.0]).range(["hsl(33,87%,29%)" ,"hsl(0,0%,96%)","hsl(175,98%,20%)" ]);
				//range_c3=d3.scale.linear().domain([0.0,0.5,1.0]).range(["hsl(175,98%,20%)" ,"hsl(0,0%,96%)","hsl(33,87%,29%)" ]);//"#fee08b","red" ]);
				//range_c4=d3.scale.linear().domain([0.0,30000, 200000]).range(["hsl(33,87%,29%)" ,"hsl(0,0%,96%)","hsl(175,98%,20%)" ]);
				
				var region = {
					// "High-income Western countries": {name:"1", x: (width*0.25), y: (height*0.25)},
					// "Sub-Saharan Africa": {name:"8", x: (width*0.5), y: (height*0.75)},
					// "Central Asia, Middle East and North Africa": {name:"4", x: (width*0.25), y: (height*0.5)},
					// "East and South East Asia": {name:"7", x: (width*0.25), y: (height*0.75)},
					// "Central and Eastern Europe": {name:"5", x: (width*0.5), y: (height*0.5)},
					// "Latin America and Caribbean": {name:"3", x: (width*0.75), y: (height*0.25)}, 
					// "High-income Asia Pacific": {name:"2", x: (width*0.5), y: (height*0.25)},
							  
					// "South Asia": {name:"6", x: (width*0.75), y: (height*0.5)}, 
				  // "Oceania": {name:"9", x: (width*0.75), y: (height*0.75)}
					"Sub-Saharan Africa": {name:"0", x: (width*0.25), y: (height*0.25)},
					"Central Asia, Middle East and North Africa": {name:"1", x: (width*0.25), y: (height*0.5)},
					"South Asia": {name:"2", x: (width*0.5), y: (height*0.75)},
					"East and South East Asia": {name:"3", x: (width*0.5), y: (height*0.5)},			
					"High-income Asia Pacific": {name:"4", x: (width*0.75), y: (height*0.25)}, 
					"Oceania": {name:"5", x: (width*0.25), y: (height*0.75)},
					"Latin America and Caribbean": {name:"6", x: (width*0.5), y: (height*0.25)},
					"High-income Western countries": {name:"7", x: (width*0.75), y: (height*0.5)}, 
					"Central and Eastern Europe": {name:"8", x: (width*0.75), y: (height*0.75)}
				  
				}
				
				//for (elem in region){
				//	listMRegions.push(elem);
				//}	
				svg = d3.select("#graph-container").append("svg")
					.attr("width", width)
					.attr("height", height);
				
				var gradient1 = svg
					.append("linearGradient")
					.attr("y1", "0")
					.attr("y2","0")
					.attr("x1", "0%")
					.attr("x2", "100%")
					.attr("id", "gradient1")
					//.attr("gradientUnits", "userSpaceOnUse")
					
				gradient1
					.append("stop")
					.attr("offset", "0%")
					.attr("stop-color", "red")
				gradient1
					.append("stop")
					.attr("offset", "50%")
					.attr("stop-color", "#fee08b")	
				gradient1
					.append("stop")
					.attr("offset", "100%")
					.attr("stop-color", "green")
				
				var gradient1b = svg
					.append("linearGradient")
					.attr("y1", "0")
					.attr("y2","0")
					.attr("x1", "0%")
					.attr("x2", "100%")
					.attr("id", "gradient1b")
					//.attr("gradientUnits", "userSpaceOnUse")
					
				gradient1b
					.append("stop")
					.attr("offset", "0%")
					.attr("stop-color", "hsl(33,87%,29%)")
				gradient1b
					.append("stop")
					.attr("offset", "50%")
					.attr("stop-color", "hsl(0,0%,96%)")	
				gradient1b
					.append("stop")
					.attr("offset", "100%")
					.attr("stop-color", "hsl(175,98%,20%)")
				
				var gradient2 = svg
					.append("linearGradient")
					.attr("y1", "0")
					.attr("y2","0")
					.attr("x1", "0%")
					.attr("x2", "100%")
					.attr("id", "gradient2")
					//.attr("gradientUnits", "userSpaceOnUse")
					
				gradient2
					.append("stop")
					.attr("offset", "0%")
					.attr("stop-color", "blue")
				gradient2
					.append("stop")
					.attr("offset", "50%")
					.attr("stop-color", "#fee08b")	
				gradient2
					.append("stop")
					.attr("offset", "100%")
					.attr("stop-color", "red")
				
				var gradient2b = svg
					.append("linearGradient")
					.attr("y1", "0")
					.attr("y2","0")
					.attr("x1", "0%")
					.attr("x2", "100%")
					.attr("id", "gradient2b")
					//.attr("gradientUnits", "userSpaceOnUse")
					
				gradient2b
					.append("stop")
					.attr("offset", "0%")
					.attr("stop-color", "hsl(175,98%,20%)")
				gradient2b
					.append("stop")
					.attr("offset", "50%")
					.attr("stop-color", "hsl(0,0%,96%)")	
				gradient2b
					.append("stop")
					.attr("offset", "100%")
					.attr("stop-color", "hsl(33,87%,29%)")
				
				
				
				var legend_mreg = svg.append("g")
						.attr("class", "legend_mreg")
						.attr("x", 0)
						.attr("y", 25)
						.attr("height", 100)
						.attr("width", 100);
				
				
				//console.log(listMRegions)
				legend_mreg.selectAll('g').data(listMRegions)
						.enter()
						.append('g')
						.each(function(d, i) {
							var g = d3.select(this);
							var myx =(width*0.29)-150;
							var myy =20;
							
							myx =(width*0.55)-100
							myy =10;
							g.append("rect")
							  .attr("x", (width *0.25)+((width *0.5)*0.111111*i))
							  .attr("y", (7))//.attr("y", (7))
							  .attr("width", (width *0.5)*0.111111)
							  .attr("height", 10)
							  .style("fill", regioncolor(d))	
								.on("mouseover", function () { 
								var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
								//d3.select(this).style("stroke-width",20);
								tooltip.classed("hidden", false)
									.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+($('#graph-container').position().top+35)+"px")
									.html(function(){
										return d
										
									});
									
							  })
							  .on("mouseout", function () { 
								//if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
								tooltip.classed("hidden", true);
							  });
							

						});
						
				//d3.selectAll(".legend_edu").style("visibility","hidden");
				
				
				
				var legend_edu = svg.append("g")
						.attr("class", "legend_edu")
						.attr("x", 0)
						.attr("y", 25)
						.attr("height", 100)
						.attr("width", 100);
						
				legend_edu.selectAll('g').data(["education"])
						.enter()
						.append('g')
						.each(function(d, i) {
							var g = d3.select(this);
							var myx =(width*0.29)-150;
							var myy =20;
							
							myx =(width*0.55)-100
							myy =10;
							g.append("rect")
							  .attr("x", (width *0.25))
							  .attr("y", (7))//.attr("y", (7))
							  .attr("width", (width *0.5))
							  .attr("height", 10)
							  .style("fill", c2gradient);	
							
							g.append("text")
							  .attr("x",(width *0.25)-5) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("0");
							 g.append("text")
							  .attr("x",(width *0.75)-20) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("20 years");

						});
						
				d3.selectAll(".legend_edu").style("visibility","hidden");
				
				var legend_gdp = svg.append("g")
						.attr("class", "legend_gdp")
						.attr("x", 0)
						.attr("y", 25)
						.attr("height", 100)
						.attr("width", 100);
						
				legend_gdp.selectAll('g').data(["gdp"])
				.enter()
				.append('g')
				.each(function(d, i) {
					var g = d3.select(this);
					var myx =(width*0.29)-150;
					var myy =20;
					
					myx =(width*0.55)-100
					myy =10;
					g.append("rect")
					  .attr("x", (width *0.25))
					  .attr("y", (7))//.attr("y", (7))
					  .attr("width", (width *0.5))
					  .attr("height", 10)
					  .style("fill", c4gradient);	
					//g.append("text")
					//  .attr("x",(width *0.25)-70) 
					//  .attr("y", 15)
					//  .attr("height",30)
					//  .attr("width",100)
					//  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
					//  .style("font-size","small")
					//  .text(d);
					g.append("text")
					  .attr("x",(width *0.25)-17) 
					  .attr("y", 30)
					  .attr("height",30)
					  .attr("width",100)
					  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
					  .style("font-size","small")
					  .text("$200");
					g.append("text")
					  .attr("x",(width *0.5)-22) 
					  .attr("y", 30)
					  .attr("height",30)
					  .attr("width",100)
					  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
					  .style("font-size","small")
					  .text("$20,000");  
					g.append("text")
					  .attr("x",(width *0.75)-30) 
					  .attr("y", 30)
					  .attr("height",30)
					  .attr("width",100)
					  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
					  .style("font-size","small")
					  .text("$200,000");

				});
				d3.selectAll(".legend_gdp").style("visibility","hidden");
				d3.select("#x1").style("visibility","hidden");
				var legend_urb = svg.append("g")
						.attr("class", "legend_urb")
						.attr("x", 0)
						.attr("y", 25)
						.attr("height", 100)
						.attr("width", 100);
						
				legend_urb.selectAll('g').data(["urbanisation"])
				.enter()
				.append('g')
				.each(function(d, i) {
					var g = d3.select(this);
					var myx =(width*0.29)-150;
					var myy =20;
					
					myx =(width*0.55)-100
					myy =10;
					g.append("rect")
					  .attr("x", (width *0.25))
					  .attr("y", (7))//.attr("y", (7))
					  .attr("width", (width *0.5))
					  .attr("height", 10)
					  .style("fill", c3gradient);	
					//g.append("text")
					//  .attr("x",(width *0.25)-70) 
					//  .attr("y", 15)
					//  .attr("height",30)
					//  .attr("width",100)
					//  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
					//  .style("font-size","small")
					//  .text(d);
					g.append("text")
					  .attr("x",(width *0.25)-7) 
					  .attr("y", 30)
					  .attr("height",30)
					  .attr("width",100)
					  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
					  .style("font-size","small")
					  .text("0%");
					g.append("text")
					  .attr("x",(width *0.5)-10) 
					  .attr("y", 30)
					  .attr("height",30)
					  .attr("width",100)
					  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
					  .style("font-size","small")
					  .text("50%");  
					g.append("text")
					  .attr("x",(width *0.75)-10) 
					  .attr("y", 30)
					  .attr("height",30)
					  .attr("width",100)
					  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
					  .style("font-size","small")
					  .text("100%");

				});
				d3.selectAll(".legend_urb").style("visibility","hidden");
				
				
				var x; //= d3.scale.pow().exponent(.5).domain([0, 200000]).range([0,width-50]);				
				var y = d3.scale.linear().domain([0, 0.6]).range([height-50,30]);
				//console.log(height-13)
				var xAxis;// = d3.svg.axis()
				//	.scale(x).tickFormat(function(d, i){return formatGDP(d)+""}).tickValues([500,10000, 30000,60000,100000,160000])  // education .tickFormat(function(d, i){return d+""}).tickValues([0,5,10,15,20]) // // urbanisation .tickFormat(function(d, i){return formatPer0(d)+""}).tickValues([0,0.25,0.5,0.75,1.0]) // 
				//	.orient("bottom");

				var yAxis = d3.svg.axis()
					.scale(y).tickFormat(function(d, i){return formatPer0(d)+""}).tickValues([0,0.2, 0.4,0.6])
					.orient("left");
				var my_xaxis;//= svg.append("g")
					// .attr("class", "x axis")
					// .attr("transform", "translate("+50+"," +(height+30)+ ")")
					// .call(xAxis)
					// .append("text")
					// .attr("x", 0)
					// .attr("y", 0)
					// .attr("dx", (width-60)+"px")
					// .attr("dy", "-0.5em")
					// .attr("font-size", "11px")
					// .style("text-anchor", "end")
					// .text("");
				//console.log(height)
				var my_yaxis= svg.append("g")
					.attr("class", "y axis")
					.attr("transform", "translate("+50+"," + (0)+ ")")
					.call(yAxis)
					.append("text")
					.attr("transform", "rotate(-90)")
					.attr("y", 6)
					.attr("x", -30)
					.attr("dy", ".71em")
					.attr("dx", "-0.25em")
					.attr("font-size", "11px")
					.style("text-anchor", "end")
					.text("Prevalence");
				
				d3.selectAll(".x.axis").style("visibility","hidden");
				d3.selectAll(".y.axis").style("visibility","hidden");
				
				var maxRadius=0;
				var padding_border=35;
				for (var i=0, j=data.length;i<j;i++){
					data[i].x=_.random(padding_border, width-padding_border);
					data[i].y=_.random(padding_border, height-padding_border);
					if (check_g==false){
						if (data[i]['timedata'][parseInt(check_y)-1975]){
						data[i].radius=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
						if (maxRadius<data[i].radius){maxRadius=data[i].radius};}
						
					}
					else{
						if(data[i]['timedata'][parseInt(check_y)-1975]){
						data[i].radius=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
						if (maxRadius<data[i].radius){maxRadius=data[i].radius};
						}
					}
					
				}
				var padding = 3;
				var getCenters = function (vname, size) {
					var centers, map;
					centers = _.uniq(_.pluck(data, vname)).map(function (d) {
						return {name: d, value: 1};
					});

					map = d3.layout.treemap().size(size).ratio(1/1);
					map.nodes({children: centers});
					return centers;
				};
				centers = getCenters(selectedMode, [width, height]);
				var foci = {};
				for (var i = 0; i < centers.length; i++) {
				 foci[centers[i].name] = centers[i];
				}
				
				var mynodes=[];
				for (var i=0,j=data.length;i<j;i++){
					if(selectedMode=="all"){
						var f = foci[data[i][selectedMode]];
						var mcx= (f.dx / 2);
						var mcy= (f.dy / 2);
					}
					mynodes.push({name:data[i].name, region: data[i].region, cx: mcx , cy: mcy, radius:data[i].radius, color:"red" });
				}
				
				//width = ((window.innerWidth*0.99)-311);//width = ((window.innerWidth*0.99)-261);//document.getElementById('graph-container').offsetWidth;
				//	height=width*0.6;//height=Math.max(220,(window.innerHeight-($('#graph-container').position().top)-100));
					document.getElementById('red').style.width=((width-30))+"px";
				//	svg.attr("width", width).attr("height", height);
				var force = d3.layout.force()
					.nodes(mynodes)
					.size([width, height])
					.gravity(0)
					.charge(0)
					.on("tick", tick)
					.start();
				
				
				var circle = svg.selectAll("circle")
					.data(mynodes)
					.enter().append("circle")
					.attr("r", function(d) { return d.radius; })
					.attr("class","normal")
					.style("fill", function(d) { return mcolor(d.region) })
					
					.on("mouseover", function (d,i) { 
					
						var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
						if (d3.select(this).classed("normal")){
							d3.select(this).classed("unselected-underlined",true);
						}
						tooltip.classed("hidden", false)
							.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
							.html(function(){
								var per = d3.format(",.2%");
								var gd = d3.format("$,f");
								//var pop = d3.format(",f");+per(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])
								if (check_g==true){
									return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
								}
								else{
									
									return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
								}
								
							});
							
					  })
					  .on("mouseout", function (d) { 
						if (d3.select(this).classed("normal")){
							d3.select(this).classed("unselected-underlined",false);
						}
						tooltip.classed("hidden", true);
					  });
					  //.call(force.drag);
				//updateWindow()	
				function tick(e) {
					var k = 0.09;
					mynodes.forEach(function(o, i) {
						var my_x; 
						var my_y;
						if(selectedMode!="all"){
							var f = foci[o["region"]];
							my_x = f.x+(f.dx/2);
							my_y = f.y+(f.dy/2)+35;
							o.y += (my_y - o.y) * (0.4) * k;
							o.x += (my_x - o.x) * (0.4) * k;
						}
						
					});
					
					
							
					if(selectedMode=="all"){
						padding=3;
						circle.data(mynodes)
						.each(gravity(.07 * e.alpha))
						.each(collide(.45))
						.attr("cx", function(d) { return d.x; })
						.attr("cy", function(d) { return d.y; });
					}	
					else{
						padding=3;
						circle.data(mynodes)
						//.each(gravity(.0007 * e.alpha))
						.each(collide(.45))
						.attr("cx", function(d) { return d.x; })
						.attr("cy", function(d) { return d.y; });
					}
						
					
				}
				// Move nodes toward cluster focus.
				function gravity(alpha) {
					return function(d) {
						d.y += (d.cy - d.y) * alpha;
						d.x += (d.cx - d.x) * alpha;
					};
				}
				// Resolve collisions between nodes.
				function collide(alpha) {
				  var quadtree = d3.geom.quadtree(mynodes);
				  return function(d) {
					var r = d.radius + maxRadius + padding,
						nx1 = d.x - r,
						nx2 = d.x + r,
						ny1 = d.y - r,
						ny2 = d.y + r;
					quadtree.visit(function(quad, x1, y1, x2, y2) {
					  if (quad.point && (quad.point !== d)) {
						var x = d.x - quad.point.x,
							y = d.y - quad.point.y,
							l = Math.sqrt(x * x + y * y),
							r = d.radius + quad.point.radius + padding;//(d.color !== quad.point.color) * padding;
						if (l < r) {
						  l = (l - r) / l *0.3;//*(alpha*1.1);// alpha;//*0.9;
						  d.x -= x *= l;
						  d.y -= y *= l;
						  quad.point.x += x;
						  quad.point.y += y;
						}
					  }
					  return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
					});
				  };
				}
					
				function order(a, b) {
					return b.radius - a.radius;
				}	

				setGraphPlot();
				
				////////////////////////////////	
				var matrix = my_xaxis[0][0].getScreenCTM();
				$('#x1').css('left',410)
				$('#x1').css('top',398)
				$('#optsb').css('left',32)
				$('#optsb').css('top',362)
				////////////////////////////////
				
				
				$( ".bbt" ).click(function() {
					var check_y = parseInt(slider.noUiSlider.get());
					var check_g = document.getElementById("selectGender").checked;
					var check_gr = document.getElementById("selectColor").checked;
					selectedMode=this.id;	
					//updateWindow();
					foci=[]
					centers = getCenters(selectedMode, [width, height-35]);
					for (var i = 0; i < centers.length; i++) {
					 foci[centers[i].name] = centers[i];
					}
					//console.log(foci)
					
					maxRadius=0;
					padding_border=35;
					for (var i=0, j=data.length;i<j;i++){
						data[i].x=_.random(padding_border, width-padding_border);
						data[i].y=_.random(padding_border, height-padding_border);
						if (check_g==false){
							if (data[i]['timedata'][parseInt(check_y)-1975]){
							data[i].radius=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
							if (maxRadius<data[i].radius){maxRadius=data[i].radius};}
							
						}
						else{
							if(data[i]['timedata'][parseInt(check_y)-1975]){
							data[i].radius=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
							if (maxRadius<data[i].radius){maxRadius=data[i].radius};
							}
						}
						
					}
					
					for (var i=0,j=data.length;i<j;i++){
						var mcx;
						var mcy;
						if(selectedMode=="all"){
							var f = foci[data[i][selectedMode]];
							mcx= (f.dx / 2);
							mcy= (f.dy / 2);
						}
						
						if(selectedMode!="all"){
							var f = foci[mynodes[i]["region"]];
							mcx = f.x+(f.dx/2);
							mcy = f.y+(f.dy/2);
						}
						
						mynodes[i]['cx']=mcx ; 
						mynodes[i]['cy']=mcy;
						mynodes[i]['radius']=data[i].radius;
						
					}
					
					if(selectedMode!="all"){
						svg.selectAll("rect").remove();
						svg.selectAll("text").remove();
						//reg_nodes.delete();
						var reg_nodes = svg.selectAll("rect").data(centers);
						
						reg_nodes.enter().append("rect")
							.attr("class", "rnode behind")
							.attr("x", function (d) { return d.x; })
							.attr("y", function (d) { return d.y+35; })
							.attr("width", function (d) { return (d.dx); })
							.attr("height", function (d) { return (d.dy); })
							.style("stroke", function (d,i) { return "#000000"; })
							.style("fill", function (d,i) { return "#ffffff"; })
							.style("opacity", function (d) { return 0.0; });
							//.attr("class", "behind node");
						d3.selectAll(".rnode").transition().duration(200).style("opacity", function (d) { return 0.1; });
						
						var reg_nodes_t = svg.selectAll("text").data(centers);
						reg_nodes_t.enter().append("text")
							.text(function (d,i) { if((d.name.length*5.5 )> d.dx)
														return d.name.substring(0,(parseInt(d.dx/5.5 )))+'...';
												   else
														return d.name; return d.name; })
							.attr("x", function (d) { return d.x; })
							.attr("y", function (d) { return d.y+35; })
							.attr("dy", function (d) { return 15; })
							.attr('fill', 'black')
							.attr('font-size','10px') 
							.style("opacity", function (d) { return 0.0; })
							.attr("class", "tnode behind");
						d3.selectAll(".tnode").transition().duration(200).style("opacity", function (d) { return 1.0; });
					}
					else{
						
					
						d3.selectAll(".rnode").transition().duration(200).style("opacity", function (d) { return 0.0; });
						d3.selectAll(".tnode").transition().duration(200).style("opacity", function (d) { return 0.0; });
					}
					
					
					if(selectedColorMode=="c1"){
						
						
							legend_mreg.remove();
							legend_mreg = svg.append("g")
							.attr("class", "legend_mreg")
							.attr("x", 0)
							.attr("y", 25)
							.attr("height", 100)
							.attr("width", 100);
					
					
							//console.log(listMRegions)
							legend_mreg.selectAll('g').data(listMRegions)
							.enter()
							.append('g')
							.each(function(d, i) {
								var g = d3.select(this);
								var myx =(width*0.29)-150;
								var myy =20;
								
								myx =(width*0.55)-100
								myy =10;
								g.append("rect")
								  .attr("x", (width *0.25)+((width *0.5)*0.111111*i))
								  .attr("y", (7))//.attr("y", (7))
								  .attr("width", (width *0.5)*0.111111)
								  .attr("height", 10)
								  .style("fill", regioncolor(d))	
									.on("mouseover", function () { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									//d3.select(this).style("stroke-width",20);
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+($('#graph-container').position().top+35)+"px")
										.html(function(){
											return d
											
										});
										
								  })
								  .on("mouseout", function () { 
									//if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								  });
								

							});
						
						d3.selectAll(".legend_mreg").style("visibility","visible");
						d3.selectAll(".legend_edu").style("visibility","hidden");
						d3.selectAll(".legend_urb").style("visibility","hidden");
						d3.selectAll(".legend_gdp").style("visibility","hidden");
					}
					else if(selectedColorMode=="c2"){
						
						
						legend_edu.remove();
						legend_edu = svg.append("g")
						.attr("class", "legend_edu")
						.attr("x", 0)
						.attr("y", 25)
						.attr("height", 100)
						.attr("width", 100);
						
						legend_edu.selectAll('g').data(["education"])
						.enter()
						.append('g')
						.each(function(d, i) {
							var g = d3.select(this);
							var myx =(width*0.29)-150;
							var myy =20;
							
							myx =(width*0.55)-100
							myy =10;
							g.append("rect")
							  .attr("x", (width *0.25))
							  .attr("y", (7))//.attr("y", (7))
							  .attr("width", (width *0.5))
							  .attr("height", 10)
							  .style("fill", c2gradient);	
							
							g.append("text")
							  .attr("x",(width *0.25)-5) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("0");
							 g.append("text")
							  .attr("x",(width *0.75)-20) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("20 years");

						});
						
						d3.selectAll(".legend_mreg").style("visibility","hidden");
						d3.selectAll(".legend_edu").style("visibility","visible");
						d3.selectAll(".legend_urb").style("visibility","hidden");
						d3.selectAll(".legend_gdp").style("visibility","hidden");
					}
					else if(selectedColorMode=="c3"){
						
						legend_urb.remove();
						legend_urb = svg.append("g")
						.attr("class", "legend_urb")
						.attr("x", 0)
						.attr("y", 25)
						.attr("height", 100)
						.attr("width", 100);
						
						legend_urb.selectAll('g').data(["urbanisation"])
						.enter()
						.append('g')
						.each(function(d, i) {
							var g = d3.select(this);
							var myx =(width*0.29)-150;
							var myy =20;
							
							myx =(width*0.55)-100
							myy =10;
							g.append("rect")
							  .attr("x", (width *0.25))
							  .attr("y", (7))//.attr("y", (7))
							  .attr("width", (width *0.5))
							  .attr("height", 10)
							  .style("fill", c3gradient);	
							//g.append("text")
							//  .attr("x",(width *0.25)-70) 
							//  .attr("y", 15)
							//  .attr("height",30)
							//  .attr("width",100)
							//  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							//  .style("font-size","small")
							//  .text(d);
							g.append("text")
							  .attr("x",(width *0.25)-7) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("0%");
							g.append("text")
							  .attr("x",(width *0.5)-10) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("50%");  
							g.append("text")
							  .attr("x",(width *0.75)-10) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("100%");

						});
								
						d3.selectAll(".legend_mreg").style("visibility","hidden");
						d3.selectAll(".legend_edu").style("visibility","hidden");
						d3.selectAll(".legend_urb").style("visibility","visible");
						d3.selectAll(".legend_gdp").style("visibility","hidden");
					}
					else if(selectedColorMode=="c4"){
						
						legend_gdp.remove();
						legend_gdp = svg.append("g")
						.attr("class", "legend_gdp")
						.attr("x", 0)
						.attr("y", 25)
						.attr("height", 100)
						.attr("width", 100);
						
						legend_gdp.selectAll('g').data(["gdp"])
						.enter()
						.append('g')
						.each(function(d, i) {
							var g = d3.select(this);
							var myx =(width*0.29)-150;
							var myy =20;
							
							myx =(width*0.55)-100
							myy =10;
							g.append("rect")
							  .attr("x", (width *0.25))
							  .attr("y", (7))//.attr("y", (7))
							  .attr("width", (width *0.5))
							  .attr("height", 10)
							  .style("fill", c4gradient);	
							//g.append("text")
							//  .attr("x",(width *0.25)-70) 
							//  .attr("y", 15)
							//  .attr("height",30)
							//  .attr("width",100)
							//  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							//  .style("font-size","small")
							//  .text(d);
							g.append("text")
							  .attr("x",(width *0.25)-17) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("$200");
							g.append("text")
							  .attr("x",(width *0.5)-22) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("$20,000");  
							g.append("text")
							  .attr("x",(width *0.75)-30) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("$200,000");

						});
						
						d3.selectAll(".legend_mreg").style("visibility","hidden");
						d3.selectAll(".legend_edu").style("visibility","hidden");
						d3.selectAll(".legend_urb").style("visibility","hidden");
						d3.selectAll(".legend_gdp").style("visibility","visible");
					}
					
					
					
					force.resume();
				});	
				
				
				$( ".bbt2" ).click(function() {
					selectedColorMode=this.id;	
					//console.log(selectedColorMode)
					if(selectedColorMode=="c1"){
						circle.transition().duration(0).style("fill", function (d,i) {return map_region_color[d.region];});
						
							legend_mreg.remove();
							legend_mreg = svg.append("g")
							.attr("class", "legend_mreg")
							.attr("x", 0)
							.attr("y", 25)
							.attr("height", 100)
							.attr("width", 100);
					
					
							//console.log(listMRegions)
							legend_mreg.selectAll('g').data(listMRegions)
							.enter()
							.append('g')
							.each(function(d, i) {
								var g = d3.select(this);
								var myx =(width*0.29)-150;
								var myy =20;
								
								myx =(width*0.55)-100
								myy =10;
								g.append("rect")
								  .attr("x", (width *0.25)+((width *0.5)*0.111111*i))
								  .attr("y", (7))//.attr("y", (7))
								  .attr("width", (width *0.5)*0.111111)
								  .attr("height", 10)
								  .style("fill", regioncolor(d))	
									.on("mouseover", function () { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									//d3.select(this).style("stroke-width",20);
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+($('#graph-container').position().top+35)+"px")
										.html(function(){
											return d
											
										});
										
								  })
								  .on("mouseout", function () { 
									//if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								  });
								

							});
						
						d3.selectAll(".legend_mreg").style("visibility","visible");
						d3.selectAll(".legend_edu").style("visibility","hidden");
						d3.selectAll(".legend_urb").style("visibility","hidden");
						d3.selectAll(".legend_gdp").style("visibility","hidden");
					}
					else if(selectedColorMode=="c2"){
						circle.transition().duration(0).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});
						
						legend_edu.remove();
						legend_edu = svg.append("g")
						.attr("class", "legend_edu")
						.attr("x", 0)
						.attr("y", 25)
						.attr("height", 100)
						.attr("width", 100);
						
						legend_edu.selectAll('g').data(["education"])
						.enter()
						.append('g')
						.each(function(d, i) {
							var g = d3.select(this);
							var myx =(width*0.29)-150;
							var myy =20;
							
							myx =(width*0.55)-100
							myy =10;
							g.append("rect")
							  .attr("x", (width *0.25))
							  .attr("y", (7))//.attr("y", (7))
							  .attr("width", (width *0.5))
							  .attr("height", 10)
							  .style("fill", c2gradient);	
							
							g.append("text")
							  .attr("x",(width *0.25)-5) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("0");
							 g.append("text")
							  .attr("x",(width *0.75)-20) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("20 years");

						});
						
						d3.selectAll(".legend_mreg").style("visibility","hidden");
						d3.selectAll(".legend_edu").style("visibility","visible");
						d3.selectAll(".legend_urb").style("visibility","hidden");
						d3.selectAll(".legend_gdp").style("visibility","hidden");
					}
					else if(selectedColorMode=="c3"){
						circle.transition().duration(0).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});
						legend_urb.remove();
						legend_urb = svg.append("g")
						.attr("class", "legend_urb")
						.attr("x", 0)
						.attr("y", 25)
						.attr("height", 100)
						.attr("width", 100);
						
						legend_urb.selectAll('g').data(["urbanisation"])
						.enter()
						.append('g')
						.each(function(d, i) {
							var g = d3.select(this);
							var myx =(width*0.29)-150;
							var myy =20;
							
							myx =(width*0.55)-100
							myy =10;
							g.append("rect")
							  .attr("x", (width *0.25))
							  .attr("y", (7))//.attr("y", (7))
							  .attr("width", (width *0.5))
							  .attr("height", 10)
							  .style("fill", c3gradient);	
							//g.append("text")
							//  .attr("x",(width *0.25)-70) 
							//  .attr("y", 15)
							//  .attr("height",30)
							//  .attr("width",100)
							//  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							//  .style("font-size","small")
							//  .text(d);
							g.append("text")
							  .attr("x",(width *0.25)-7) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("0%");
							g.append("text")
							  .attr("x",(width *0.5)-10) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("50%");  
							g.append("text")
							  .attr("x",(width *0.75)-10) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("100%");

						});
								
						d3.selectAll(".legend_mreg").style("visibility","hidden");
						d3.selectAll(".legend_edu").style("visibility","hidden");
						d3.selectAll(".legend_urb").style("visibility","visible");
						d3.selectAll(".legend_gdp").style("visibility","hidden");
					}
					else if(selectedColorMode=="c4"){
						circle.transition().duration(0).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});
						legend_gdp.remove();
						legend_gdp = svg.append("g")
						.attr("class", "legend_gdp")
						.attr("x", 0)
						.attr("y", 25)
						.attr("height", 100)
						.attr("width", 100);
						
						legend_gdp.selectAll('g').data(["gdp"])
						.enter()
						.append('g')
						.each(function(d, i) {
							var g = d3.select(this);
							var myx =(width*0.29)-150;
							var myy =20;
							
							myx =(width*0.55)-100
							myy =10;
							g.append("rect")
							  .attr("x", (width *0.25))
							  .attr("y", (7))//.attr("y", (7))
							  .attr("width", (width *0.5))
							  .attr("height", 10)
							  .style("fill", c4gradient);	
							//g.append("text")
							//  .attr("x",(width *0.25)-70) 
							//  .attr("y", 15)
							//  .attr("height",30)
							//  .attr("width",100)
							//  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							//  .style("font-size","small")
							//  .text(d);
							g.append("text")
							  .attr("x",(width *0.25)-17) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("$200");
							g.append("text")
							  .attr("x",(width *0.5)-22) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("$20,000");  
							g.append("text")
							  .attr("x",(width *0.75)-30) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("$200,000");

						});
						
						d3.selectAll(".legend_mreg").style("visibility","hidden");
						d3.selectAll(".legend_edu").style("visibility","hidden");
						d3.selectAll(".legend_urb").style("visibility","hidden");
						d3.selectAll(".legend_gdp").style("visibility","visible");
					}
				});
				
				
				
					
				//////////////////////////////////////////////////////////
				function setGraphPlot() {
				//console.log("ccccc")
					var check_y = parseInt(slider.noUiSlider.get());
					document.getElementById("selectGraph").checked=true;
					var s_g =  document.getElementById("selectGraph").checked;
					var check_g = document.getElementById("selectGender").checked;
					var check_gr = document.getElementById("selectColor").checked;
					var select_x = document.getElementById("x1").value;
					
					
					
					//console.log(select_x )
					if (s_g==false){
						
						d3.select("#x1").style("visibility","hidden");
						d3.select("#grby").style("visibility","visible");
						d3.selectAll(".x.axis").style("visibility","hidden");
						d3.selectAll(".y.axis").style("visibility","hidden");
						
						maxRadius=0;
						padding_border=35;
						for (var i=0, j=data.length;i<j;i++){
							data[i].x=_.random(padding_border, width-padding_border);
							data[i].y=_.random(padding_border, height-padding_border);
							if (check_g==false){
								if (data[i]['timedata'][parseInt(check_y)-1975]){
								data[i].radius=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
								if (maxRadius<data[i].radius){maxRadius=data[i].radius};}
								
							}
							else{
								if(data[i]['timedata'][parseInt(check_y)-1975]){
								data[i].radius=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
								if (maxRadius<data[i].radius){maxRadius=data[i].radius};
								}
							}
							
						}
						padding = 3;
						foci={}
						centers = getCenters(selectedMode, [width, height-35]);
						for (var i = 0; i < centers.length; i++) {
						 foci[centers[i].name] = centers[i];
						}
						for (var i=0,j=data.length;i<j;i++){
							var mcx;
							var mcy;
							if(selectedMode=="all"){
								var f = foci[data[i][selectedMode]];
								mcx= (f.dx / 2);
								mcy= (f.dy / 2);
							}
							
							if(selectedMode!="all"){
								var f = foci[mynodes[i]["region"]];
								mcx = f.x+(f.dx/2);
								mcy = f.y+(f.dy/2);
							}
							
							mynodes[i]['cx']=mcx ; 
							mynodes[i]['cy']=mcy;
							mynodes[i]['radius']=data[i].radius;
							
						}
					
						if(selectedMode!="all"){
							d3.selectAll(".rnode").transition().duration(200).style("opacity", function (d) { return 0.1; });
							d3.selectAll(".tnode").transition().duration(200).style("opacity", function (d) { return 1.0; });
						}		
					
						if (check_g==true){
						
							maxRadius=0;
							for (var i=0, j=data.length;i<j;i++){
								
								if (check_g==false){
									
									var tpp=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									if (maxRadius<tpp){
										maxRadius=tpp
									};
									
								}
								else{
									
									var tpp=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									if (maxRadius<tpp){
										maxRadius=tpp
									};
									
								}
								
							}
							for (var i=0,j=data.length;i<j;i++){
								
								mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
								//mynodes[i]['color']= mcolor(data[i].region);
							}
							 //circle
								///.each(gravity(.0))
								//.each(collide(.0))
								//.attr("cx", function(d) { return d.x; })
								//.attr("cy", function(d) { return d.y; });
							
							//circle.transition().duration(200).style("fill", function (d,i) {return map_region_color[d.region];});
							if(selectedColorMode=="c1"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); });
							}
							else if(selectedColorMode=="c2"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); });
							}
							else if(selectedColorMode=="c3"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); });
							}
							else if(selectedColorMode=="c4"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); });
							}
							
							
							circle.on("mouseover", function (d,i) { 
								var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
								if (d3.select(this).classed("normal")){
									d3.select(this).classed("unselected-underlined",true);
								}
								tooltip.classed("hidden", false)
									.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
									.html(function(){
										var per = d3.format(",.2%");
										var gd = d3.format("$,f");
										var pop = d3.format(",f"); 
										if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
										}
										else{
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
										}
										
									});
									
							  })
							  .on("mouseout", function (d) { 
								if (d3.select(this).classed("normal")){
									d3.select(this).classed("unselected-underlined",false);
								}
								tooltip.classed("hidden", true);
							  });
							//force.charge(0.7)
							force.resume();
						}
						else{
							maxRadius=0;
							for (var i=0, j=data.length;i<j;i++){
								
								if (check_g==false){
									
									var tpp=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									if (maxRadius<tpp){
										maxRadius=tpp
									};
									
								}
								else{
									
									var tpp=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									if (maxRadius<tpp){
										maxRadius=tpp
									};
									
								}
								
							}
							for (var i=0,j=data.length;i<j;i++){
								
								mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
								//mynodes[i]['color']= mcolor(data[i].region);
							}
							 //circle
								///.each(gravity(.0))
								//.each(collide(.0))
								//.attr("cx", function(d) { return d.x; })
								//.attr("cy", function(d) { return d.y; });
							
							//circle.transition().duration(200).style("fill", function (d,i) {return map_region_color[d.region];});
							if(selectedColorMode=="c1"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); });
							}
							else if(selectedColorMode=="c2"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); });
							}
							else if(selectedColorMode=="c3"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); });
							}
							else if(selectedColorMode=="c4"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); });
							}
							
							
							circle.on("mouseover", function (d,i) { 
								var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
								if (d3.select(this).classed("normal")){
									d3.select(this).classed("unselected-underlined",true);
								}
								tooltip.classed("hidden", false)
									.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
									.html(function(){
										var per = d3.format(",.2%");
										var gd = d3.format("$,f");
										//var pop = d3.format(",f");
										if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
										}
										else{
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
										}
										
									});
									
							  })
							  .on("mouseout", function (d) { 
								if (d3.select(this).classed("normal")){
									d3.select(this).classed("unselected-underlined",false);
								}
								tooltip.classed("hidden", true);
							  });
							force.resume();
						}
						
						
					}
					else{
						force.stop();
						d3.select("#x1").style("visibility","visible");
						d3.select("#grby").style("visibility","hidden");
						d3.selectAll(".x.axis").style("visibility","visible");
						d3.selectAll(".y.axis").style("visibility","visible");
						
						if(selectedMode!="all"){
							d3.selectAll(".rnode").transition().duration(200).style("opacity", function (d) { return 0.0; });
							d3.selectAll(".tnode").transition().duration(200).style("opacity", function (d) { return 0.0; });
						}	
							
						
						//d3.selectAll(".rnode").transition().duration(200).style("opacity", function (d) { return 0.0; });
						//d3.selectAll(".tnode").transition().duration(200).style("opacity", function (d) { return 0.0; });
						
						
						//var padding = 3;
						//y = d3.scale.linear().domain([0.6, 0]).range([30, height-30]);
						
						if (select_x=="gdp"){
							x = d3.scale.pow().exponent(.5).domain([0, 200000]).range([0,width-51]);
							xAxis = d3.svg.axis().scale(x).tickFormat(function(d, i){return formatGDP(d)+""}).tickValues([500,10000, 30000,60000,100000,160000]).orient("bottom");
							svg.select(".x.axis").remove();
							if (my_xaxis){
								my_xaxis.remove();	
							}
							my_xaxis= svg.append("g")
								.attr("class", "x axis")
								.attr("transform", "translate("+50+"," +(height-50)+ ")")
								.call(xAxis)
								.append("text")
								.attr("x", 0)
								.attr("y", 0)
								.attr("dx", (width-60)+"px")
								.attr("dy", "-0.5em")
								.attr("font-size", "11px")
								.style("text-anchor", "end")
								.text("");
							
							y = d3.scale.linear().domain([0, 0.6]).range([height-50,30]);
							yAxis = d3.svg.axis().scale(y).tickFormat(function(d, i){return formatPer0(d)+""}).tickValues([0,0.2, 0.4,0.6]).orient("left");
							svg.select(".y.axis").remove();
							if (my_yaxis){
								my_yaxis.remove();	
							}
							my_yaxis= svg.append("g")
								.attr("class", "y axis")
								.attr("transform", "translate("+50+"," + (0)+ ")")
								.call(yAxis)
								.append("text")
								.attr("transform", "rotate(-90)")
								.attr("y", 6)
								.attr("x", -30)
								.attr("dy", ".71em")
								.attr("dx", "-0.25em")
								.attr("font-size", "11px")
								.style("text-anchor", "end")
								.text("Prevalence");	
								
								
							
							if (check_g==true){
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['gdp']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['men'][0]));
								}
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								circle.on("mouseover", function (d,i) { 
									
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){
										d3.select(this).classed("unselected-underlined",true);
									}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								  })
								  .on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){
										d3.select(this).classed("unselected-underlined",false);
									}
									tooltip.classed("hidden", true);
								  });
								  circle.data(mynodes).sort(order);	
							}
							else{
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['gdp']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['women'][0]));
								}
								
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								circle.on("mouseover", function (d,i) { 
									
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								})
								.on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								});
								circle.data(mynodes).sort(order);	
							}
						}
						else if (select_x=="edu"){
							x = d3.scale.linear().domain([0, 15.0]).range([0, width-51]);
							xAxis = d3.svg.axis().scale(x).tickFormat(function(d, i){if (d==0){ return d+" years"} else {return d+""}}).tickValues([0,5,10]).orient("bottom");
							svg.select(".x.axis").remove();
							if (my_xaxis){
								my_xaxis.remove();	
							}
							my_xaxis= svg.append("g")
								.attr("class", "x axis")
								.attr("transform", "translate("+50+"," +(height-50)+ ")")
								.call(xAxis)
								.append("text")
								.attr("x", 0)
								.attr("y", 0)
								.attr("dx", (width-60)+"px")
								.attr("dy", "-0.5em")
								.attr("font-size", "11px")
								.style("text-anchor", "end")
								.text("");
							y = d3.scale.linear().domain([0, 0.6]).range([height-50,30]);
							yAxis = d3.svg.axis().scale(y).tickFormat(function(d, i){if (d==0){ return d+" years"} else {return d+""}}).tickValues([0,0.2, 0.4,0.6]).orient("left");
							svg.select(".y.axis").remove();
							if (my_yaxis){
								my_yaxis.remove();	
							}
							my_yaxis= svg.append("g")
								.attr("class", "y axis")
								.attr("transform", "translate("+50+"," + (0)+ ")")
								.call(yAxis)
								.append("text")
								.attr("transform", "rotate(-90)")
								.attr("y", 6)
								.attr("x", -30)
								.attr("dy", ".71em")
								.attr("dx", "-0.25em")
								.attr("font-size", "11px")
								.style("text-anchor", "end")
								.text("Prevalence");	
							if (check_g==true){
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['edu']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['men'][0]));
								}
								//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								  })
								  .on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								  });
								  circle.data(mynodes).sort(order);	
							}
							else{
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['edu']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['women'][0]));
								}
								
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								})
								.on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								});
								circle.data(mynodes).sort(order);
							}
						}
						else if (select_x=="urb"){
							x = d3.scale.linear().domain([0.0, 1.00]).range([0, width-63]);
							xAxis = d3.svg.axis().scale(x).tickFormat(function(d, i){return formatPer0(d)+""}).tickValues([0,0.25,0.5,0.75]).orient("bottom");
							svg.select(".x.axis").remove();
							if (my_xaxis){
								my_xaxis.remove();	
							}
							//my_xaxis.remove();
							
							my_xaxis= svg.append("g")
								.attr("class", "x axis")
								.attr("transform", "translate("+50+"," +(height-50)+ ")")
								.call(xAxis)
								.append("text")
								.attr("x", 0)
								.attr("y", 0)
								.attr("dx", (width-60)+"px")
								.attr("dy", "-0.5em")
								.attr("font-size", "11px")
								.style("text-anchor", "end")
								.text("");
							y = d3.scale.linear().domain([0, 0.6]).range([height-50,30]);
							yAxis = d3.svg.axis().scale(y).tickFormat(function(d, i){return formatPer0(d)+""}).tickValues([0,0.2, 0.4,0.6]).orient("left");
							svg.select(".y.axis").remove();
							if (my_yaxis){
								my_yaxis.remove();	
							}
							my_yaxis= svg.append("g")
								.attr("class", "y axis")
								.attr("transform", "translate("+50+"," + (0)+ ")")
								.call(yAxis)
								.append("text")
								.attr("transform", "rotate(-90)")
								.attr("y", 6)
								.attr("x", -30)
								.attr("dy", ".71em")
								.attr("dx", "-0.25em")
								.attr("font-size", "11px")
								.style("text-anchor", "end")
								.text("Prevalence");		
							if (check_g==true){
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['urb']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['men'][0]));
								}
								
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});									
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								
								
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								  })
								  .on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								  });
								  circle.data(mynodes).sort(order);	
							}
							else{
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['urb']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['women'][0]));
								}
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});									
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								})
								.on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								});
								circle.data(mynodes).sort(order);
							}	
						}
						
						
				
					}
				}
				
				
				
				d3.select("#selectGraph").on("change", function() {
				//console.log("ccccc")
					var check_y = parseInt(slider.noUiSlider.get());
					var s_g =  document.getElementById("selectGraph").checked;
					var check_g = document.getElementById("selectGender").checked;
					var check_gr = document.getElementById("selectColor").checked;
					var select_x = document.getElementById("x1").value;
					
					
					
					//console.log(select_x )
					if (s_g==false){
						
						d3.select("#x1").style("visibility","hidden");
						d3.select("#grby").style("visibility","visible");
						d3.selectAll(".x.axis").style("visibility","hidden");
						d3.selectAll(".y.axis").style("visibility","hidden");
						
						maxRadius=0;
						padding_border=35;
						for (var i=0, j=data.length;i<j;i++){
							data[i].x=_.random(padding_border, width-padding_border);
							data[i].y=_.random(padding_border, height-padding_border);
							if (check_g==false){
								if (data[i]['timedata'][parseInt(check_y)-1975]){
								data[i].radius=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
								if (maxRadius<data[i].radius){maxRadius=data[i].radius};}
								
							}
							else{
								if(data[i]['timedata'][parseInt(check_y)-1975]){
								data[i].radius=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
								if (maxRadius<data[i].radius){maxRadius=data[i].radius};
								}
							}
							
						}
						padding = 3;
						foci={}
						centers = getCenters(selectedMode, [width, height-35]);
						for (var i = 0; i < centers.length; i++) {
						 foci[centers[i].name] = centers[i];
						}
						for (var i=0,j=data.length;i<j;i++){
							var mcx;
							var mcy;
							if(selectedMode=="all"){
								var f = foci[data[i][selectedMode]];
								mcx= (f.dx / 2);
								mcy= (f.dy / 2);
							}
							
							if(selectedMode!="all"){
								var f = foci[mynodes[i]["region"]];
								mcx = f.x+(f.dx/2);
								mcy = f.y+(f.dy/2);
							}
							
							mynodes[i]['cx']=mcx ; 
							mynodes[i]['cy']=mcy;
							mynodes[i]['radius']=data[i].radius;
							
						}
					
						if(selectedMode!="all"){
							d3.selectAll(".rnode").transition().duration(200).style("opacity", function (d) { return 0.1; });
							d3.selectAll(".tnode").transition().duration(200).style("opacity", function (d) { return 1.0; });
						}		
					
						if (check_g==true){
						
							maxRadius=0;
							for (var i=0, j=data.length;i<j;i++){
								
								if (check_g==false){
									
									var tpp=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									if (maxRadius<tpp){
										maxRadius=tpp
									};
									
								}
								else{
									
									var tpp=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									if (maxRadius<tpp){
										maxRadius=tpp
									};
									
								}
								
							}
							for (var i=0,j=data.length;i<j;i++){
								
								mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
								//mynodes[i]['color']= mcolor(data[i].region);
							}
							 //circle
								///.each(gravity(.0))
								//.each(collide(.0))
								//.attr("cx", function(d) { return d.x; })
								//.attr("cy", function(d) { return d.y; });
							
							//circle.transition().duration(200).style("fill", function (d,i) {return map_region_color[d.region];});
							if(selectedColorMode=="c1"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); });
							}
							else if(selectedColorMode=="c2"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); });
							}
							else if(selectedColorMode=="c3"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); });
							}
							else if(selectedColorMode=="c4"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); });
							}
							
							
							circle.on("mouseover", function (d,i) { 
								var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
								if (d3.select(this).classed("normal")){
									d3.select(this).classed("unselected-underlined",true);
								}
								tooltip.classed("hidden", false)
									.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
									.html(function(){
										var per = d3.format(",.2%");
										var gd = d3.format("$,f");
										var pop = d3.format(",f"); 
										if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
										}
										else{
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
										}
										
									});
									
							  })
							  .on("mouseout", function (d) { 
								if (d3.select(this).classed("normal")){
									d3.select(this).classed("unselected-underlined",false);
								}
								tooltip.classed("hidden", true);
							  });
							//force.charge(0.7)
							force.resume();
						}
						else{
							maxRadius=0;
							for (var i=0, j=data.length;i<j;i++){
								
								if (check_g==false){
									
									var tpp=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									if (maxRadius<tpp){
										maxRadius=tpp
									};
									
								}
								else{
									
									var tpp=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									if (maxRadius<tpp){
										maxRadius=tpp
									};
									
								}
								
							}
							for (var i=0,j=data.length;i<j;i++){
								
								mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
								//mynodes[i]['color']= mcolor(data[i].region);
							}
							 //circle
								///.each(gravity(.0))
								//.each(collide(.0))
								//.attr("cx", function(d) { return d.x; })
								//.attr("cy", function(d) { return d.y; });
							
							//circle.transition().duration(200).style("fill", function (d,i) {return map_region_color[d.region];});
							if(selectedColorMode=="c1"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); });
							}
							else if(selectedColorMode=="c2"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); });
							}
							else if(selectedColorMode=="c3"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); });
							}
							else if(selectedColorMode=="c4"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); });
							}
							
							
							circle.on("mouseover", function (d,i) { 
								var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
								if (d3.select(this).classed("normal")){
									d3.select(this).classed("unselected-underlined",true);
								}
								tooltip.classed("hidden", false)
									.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
									.html(function(){
										var per = d3.format(",.2%");
										var gd = d3.format("$,f");
										//var pop = d3.format(",f");
										if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
										}
										else{
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
										}
										
									});
									
							  })
							  .on("mouseout", function (d) { 
								if (d3.select(this).classed("normal")){
									d3.select(this).classed("unselected-underlined",false);
								}
								tooltip.classed("hidden", true);
							  });
							force.resume();
						}
						
						
					}
					else{
						force.stop();
						d3.select("#x1").style("visibility","visible");
						d3.select("#grby").style("visibility","hidden");
						d3.selectAll(".x.axis").style("visibility","visible");
						d3.selectAll(".y.axis").style("visibility","visible");
						
						if(selectedMode!="all"){
							d3.selectAll(".rnode").transition().duration(200).style("opacity", function (d) { return 0.0; });
							d3.selectAll(".tnode").transition().duration(200).style("opacity", function (d) { return 0.0; });
						}	
							
						
						//d3.selectAll(".rnode").transition().duration(200).style("opacity", function (d) { return 0.0; });
						//d3.selectAll(".tnode").transition().duration(200).style("opacity", function (d) { return 0.0; });
						
						
						//var padding = 3;
						//y = d3.scale.linear().domain([0.6, 0]).range([30, height-30]);
						
						if (select_x=="gdp"){
							x = d3.scale.pow().exponent(.5).domain([0, 200000]).range([0,width-51]);
							xAxis = d3.svg.axis().scale(x).tickFormat(function(d, i){return formatGDP(d)+""}).tickValues([500,10000, 30000,60000,100000,160000]).orient("bottom");
							svg.select(".x.axis").remove();
							if (my_xaxis){
								my_xaxis.remove();	
							}
							my_xaxis= svg.append("g")
								.attr("class", "x axis")
								.attr("transform", "translate("+50+"," +(height-50)+ ")")
								.call(xAxis)
								.append("text")
								.attr("x", 0)
								.attr("y", 0)
								.attr("dx", (width-60)+"px")
								.attr("dy", "-0.5em")
								.attr("font-size", "11px")
								.style("text-anchor", "end")
								.text("");
								
							y = d3.scale.linear().domain([0, 0.6]).range([height-50,30]);
							yAxis = d3.svg.axis().scale(y).tickFormat(function(d, i){return formatPer0(d)+""}).tickValues([0,0.2, 0.4,0.6]).orient("left");
							svg.select(".y.axis").remove();
							if (my_yaxis){
								my_yaxis.remove();	
							}
							my_yaxis= svg.append("g")
								.attr("class", "y axis")
								.attr("transform", "translate("+50+"," + (0)+ ")")
								.call(yAxis)
								.append("text")
								.attr("transform", "rotate(-90)")
								.attr("y", 6)
								.attr("x", -30)
								.attr("dy", ".71em")
								.attr("dx", "-0.25em")
								.attr("font-size", "11px")
								.style("text-anchor", "end")
								.text("Prevalence");	
								
								
							
							if (check_g==true){
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['gdp']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['men'][0]));
								}
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){
										d3.select(this).classed("unselected-underlined",true);
									}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								  })
								  .on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){
										d3.select(this).classed("unselected-underlined",false);
									}
									tooltip.classed("hidden", true);
								  });
								  circle.data(mynodes).sort(order);	
							}
							else{
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['gdp']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['women'][0]));
								}
								
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								})
								.on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								});
								circle.data(mynodes).sort(order);	
							}
						}
						else if (select_x=="edu"){
							x = d3.scale.linear().domain([0, 15.0]).range([0, width-51]);
							xAxis = d3.svg.axis().scale(x).tickFormat(function(d, i){if (d==0){ return d+" years"} else {return d+""}}).tickValues([0,5,10]).orient("bottom");
							svg.select(".x.axis").remove();
							if (my_xaxis){
								my_xaxis.remove();	
							}
							my_xaxis= svg.append("g")
								.attr("class", "x axis")
								.attr("transform", "translate("+50+"," +(height-50)+ ")")
								.call(xAxis)
								.append("text")
								.attr("x", 0)
								.attr("y", 0)
								.attr("dx", (width-60)+"px")
								.attr("dy", "-0.5em")
								.attr("font-size", "11px")
								.style("text-anchor", "end")
								.text("");
							y = d3.scale.linear().domain([0, 0.6]).range([height-50,30]);
							yAxis = d3.svg.axis().scale(y).tickFormat(function(d, i){return formatPer0(d)+""}).tickValues([0,0.2, 0.4,0.6]).orient("left");
							svg.select(".y.axis").remove();
							if (my_yaxis){
								my_yaxis.remove();	
							}
							my_yaxis= svg.append("g")
								.attr("class", "y axis")
								.attr("transform", "translate("+50+"," + (0)+ ")")
								.call(yAxis)
								.append("text")
								.attr("transform", "rotate(-90)")
								.attr("y", 6)
								.attr("x", -30)
								.attr("dy", ".71em")
								.attr("dx", "-0.25em")
								.attr("font-size", "11px")
								.style("text-anchor", "end")
								.text("Prevalence");	
							if (check_g==true){
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['edu']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['men'][0]));
								}
								//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								  })
								  .on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								  });
								  circle.data(mynodes).sort(order);	
							}
							else{
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['edu']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['women'][0]));
								}
								
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								})
								.on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								});
								circle.data(mynodes).sort(order);
							}
						}
						else if (select_x=="urb"){
							x = d3.scale.linear().domain([0.0, 1.00]).range([0, width-63]);
							xAxis = d3.svg.axis().scale(x).tickFormat(function(d, i){return formatPer0(d)+""}).tickValues([0,0.25,0.5,0.75]).orient("bottom");
							svg.select(".x.axis").remove();
							if (my_xaxis){
								my_xaxis.remove();	
							}
							//my_xaxis.remove();
							
							my_xaxis= svg.append("g")
								.attr("class", "x axis")
								.attr("transform", "translate("+50+"," +(height-50)+ ")")
								.call(xAxis)
								.append("text")
								.attr("x", 0)
								.attr("y", 0)
								.attr("dx", (width-60)+"px")
								.attr("dy", "-0.5em")
								.attr("font-size", "11px")
								.style("text-anchor", "end")
								.text("");
							y = d3.scale.linear().domain([0, 0.6]).range([height-50,30]);
							yAxis = d3.svg.axis().scale(y).tickFormat(function(d, i){return formatPer0(d)+""}).tickValues([0,0.2, 0.4,0.6]).orient("left");
							svg.select(".y.axis").remove();
							if (my_yaxis){
								my_yaxis.remove();	
							}
							my_yaxis= svg.append("g")
								.attr("class", "y axis")
								.attr("transform", "translate("+50+"," + (0)+ ")")
								.call(yAxis)
								.append("text")
								.attr("transform", "rotate(-90)")
								.attr("y", 6)
								.attr("x", -30)
								.attr("dy", ".71em")
								.attr("dx", "-0.25em")
								.attr("font-size", "11px")
								.style("text-anchor", "end")
								.text("Prevalence");		
							if (check_g==true){
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['urb']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['men'][0]));
								}
								
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});									
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								
								
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								  })
								  .on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								  });
								  circle.data(mynodes).sort(order);	
							}
							else{
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['urb']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['women'][0]));
								}
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});									
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								})
								.on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								});
								circle.data(mynodes).sort(order);
							}	
						}
						
						
				
					}
				});

				d3.select("#x1").on("change", function() {
					var check_y = parseInt(slider.noUiSlider.get());
					var s_g = this.checked;
					var check_g = document.getElementById("selectGender").checked;
					var check_gr = document.getElementById("selectColor").checked;
					var select_x =this.value;
					//force.stop();
						d3.select("#x1").style("visibility","visible");
						d3.selectAll(".x.axis").style("visibility","visible");
						d3.selectAll(".y.axis").style("visibility","visible");
						//var padding = 3;
						//y = d3.scale.linear().domain([0.6, 0]).range([30, height-30]);
						
						if (select_x=="gdp"){
							x = d3.scale.pow().exponent(.5).domain([0, 200000]).range([0,width-51]);
							xAxis = d3.svg.axis().scale(x).tickFormat(function(d, i){return formatGDP(d)+""}).tickValues([500,10000, 30000,60000,100000,160000]).orient("bottom");
							svg.select(".x.axis").remove();
							if (my_xaxis){
								my_xaxis.remove();	
							}
							my_xaxis= svg.append("g")
								.attr("class", "x axis")
								.attr("transform", "translate("+50+"," +(height-50)+ ")")
								.call(xAxis)
								.append("text")
								.attr("x", 0)
								.attr("y", 0)
								.attr("dx", (width-60)+"px")
								.attr("dy", "-0.5em")
								.attr("font-size", "11px")
								.style("text-anchor", "end")
								.text("");
							
							if (check_g==true){
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['gdp']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['men'][0]));
								}
								//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								  })
								  .on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								  });
								  circle.data(mynodes).sort(order);	
							}
							else{
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['gdp']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['women'][0]));
								}
								//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								})
								.on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								});
								circle.data(mynodes).sort(order);	
							}
						}
						else if (select_x=="edu"){
							x = d3.scale.linear().domain([0, 15.0]).range([0, width-51]);
							xAxis = d3.svg.axis().scale(x).tickFormat(function(d, i){if (d==0){ return d+" years"} else {return d+""}}).tickValues([0,5,10]).orient("bottom");
							svg.select(".x.axis").remove();
							my_xaxis.remove();	
							my_xaxis= svg.append("g")
								.attr("class", "x axis")
								.attr("transform", "translate("+50+"," +(height-50)+ ")")
								.call(xAxis)
								.append("text")
								.attr("x", 0)
								.attr("y", 0)
								.attr("dx", (width-60)+"px")
								.attr("dy", "-0.5em")
								.attr("font-size", "11px")
								.style("text-anchor", "end")
								.text("");
							if (check_g==true){
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['edu']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['men'][0]));
								}
								//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								  })
								  .on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								  });
								  circle.data(mynodes).sort(order);	
							}
							else{
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['edu']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['women'][0]));
								}
								//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								})
								.on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								});
								circle.data(mynodes).sort(order);
							}
						}
						else if (select_x=="urb"){
							x = d3.scale.linear().domain([0.0, 1.00]).range([0, width-63]);
							xAxis = d3.svg.axis().scale(x).tickFormat(function(d, i){return formatPer0(d)+""}).tickValues([0,0.25,0.5,0.75]).orient("bottom");
							svg.select(".x.axis").remove();
							my_xaxis.remove();
							my_xaxis= svg.append("g")
								.attr("class", "x axis")
								.attr("transform", "translate("+50+"," +(height-50)+ ")")
								.call(xAxis)
								.append("text")
								.attr("x", 0)
								.attr("y", 0)
								.attr("dx", (width-60)+"px")
								.attr("dy", "-0.5em")
								.attr("font-size", "11px")
								.style("text-anchor", "end")
								.text("");
								
							if (check_g==true){
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['urb']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['men'][0]));
								}
								//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});									
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								  })
								  .on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								  });
								  circle.data(mynodes).sort(order);	
							}
							else{
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['urb']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['women'][0]));
								}
								//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});									
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								})
								.on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								});
								circle.data(mynodes).sort(order);
							}	
						}
				});
				
				d3.select("#selectGender").on("change", function() {
					var check_y = parseInt(slider.noUiSlider.get());
					var check_g = this.checked;
					var check_gr = document.getElementById("selectColor").checked;
					var s_g = document.getElementById("selectGraph").checked;
					var select_x =document.getElementById("x1").value;
					//console.log(select_x)
					//if (check_gr==false){
						if(s_g==false){
							if (check_g==true){
								for (var i=0,j=data.length;i<j;i++){
									
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									//mynodes[i]['color']= mcolor(data[i].region);
								}
							//console.log("aa")
								if(selectedColorMode=="c1"){
									circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).style("fill", function (d,i) {return map_region_color[d.region];});
								}
								else if(selectedColorMode=="c2"){
									circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});
								}
								else if(selectedColorMode=="c3"){
									circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});
								}
								else if(selectedColorMode=="c4"){
									circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});
								}
								
								
							}
							else{
								for (var i=0,j=data.length;i<j;i++){
									
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									//mynodes[i]['color']= mcolor(data[i].region);
								}
								if(selectedColorMode=="c1"){
									circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).style("fill", function (d,i) {return map_region_color[d.region];});
								}
								else if(selectedColorMode=="c2"){
									circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});
								}
								else if(selectedColorMode=="c3"){
									circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});
								}
								else if(selectedColorMode=="c4"){
									circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});
								}
							}
							
						
						
							circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											//var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								  })
								  .on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								  });
								//force.charge(0.7)
								force.resume();
						}
						else{
							if (select_x=="gdp"){
								x = d3.scale.pow().exponent(.5).domain([0, 200000]).range([0,width-51]);
								xAxis = d3.svg.axis().scale(x).tickFormat(function(d, i){return formatGDP(d)+""}).tickValues([500,10000, 30000,60000,100000,160000]).orient("bottom");
								svg.select(".x.axis").remove();
								if (my_xaxis){
									my_xaxis.remove();	
								}
								my_xaxis= svg.append("g")
									.attr("class", "x axis")
									.attr("transform", "translate("+50+"," +(height-50)+ ")")
									.call(xAxis)
									.append("text")
									.attr("x", 0)
									.attr("y", 0)
									.attr("dx", (width-60)+"px")
									.attr("dy", "-0.5em")
									.attr("font-size", "11px")
									.style("text-anchor", "end")
									.text("");
								
								if (check_g==true){
									for (var i=0,j=data.length;i<j;i++){
										mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
										mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['gdp']));
										mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['men'][0]));
									}
									//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									if(selectedColorMode=="c1"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									}
									else if(selectedColorMode=="c2"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
									}
									else if(selectedColorMode=="c3"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
									}
									else if(selectedColorMode=="c4"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
									}
									circle.on("mouseover", function (d,i) { 
										var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
										tooltip.classed("hidden", false)
											.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
											.html(function(){
												var per = d3.format(",.2%");
												var gd = d3.format("$,f");
												var pop = d3.format(",f");
												if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
												
											});
											
									  })
									  .on("mouseout", function (d) { 
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
										tooltip.classed("hidden", true);
									  });
									  circle.data(mynodes).sort(order);	
								}
								else{
									for (var i=0,j=data.length;i<j;i++){
										mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
										mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['gdp']));
										mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['women'][0]));
									}
									//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									if(selectedColorMode=="c1"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									}
									else if(selectedColorMode=="c2"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
									}
									else if(selectedColorMode=="c3"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
									}
									else if(selectedColorMode=="c4"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
									}
									circle.on("mouseover", function (d,i) { 
										var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
										tooltip.classed("hidden", false)
											.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
											.html(function(){
												var per = d3.format(",.2%");
												var gd = d3.format("$,f");
												var pop = d3.format(",f");
												if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
												
											});
											
									})
									.on("mouseout", function (d) { 
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
										tooltip.classed("hidden", true);
									});
									circle.data(mynodes).sort(order);	
								}
							}
							else if (select_x=="edu"){
								x = d3.scale.linear().domain([0, 15.0]).range([0, width-51]);
								xAxis = d3.svg.axis().scale(x).tickFormat(function(d, i){if (d==0){ return d+" years"} else {return d+""}}).tickValues([0,5,10]).orient("bottom");
								svg.select(".x.axis").remove();
								my_xaxis.remove();	
								my_xaxis= svg.append("g")
									.attr("class", "x axis")
									.attr("transform", "translate("+50+"," +(height-50)+ ")")
									.call(xAxis)
									.append("text")
									.attr("x", 0)
									.attr("y", 0)
									.attr("dx", (width-60)+"px")
									.attr("dy", "-0.5em")
									.attr("font-size", "11px")
									.style("text-anchor", "end")
									.text("");
								if (check_g==true){
									for (var i=0,j=data.length;i<j;i++){
										mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
										mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['edu']));
										mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['men'][0]));
									}
									//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									if(selectedColorMode=="c1"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									}
									else if(selectedColorMode=="c2"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
									}
									else if(selectedColorMode=="c3"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
									}
									else if(selectedColorMode=="c4"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
									}
									circle.on("mouseover", function (d,i) { 
										var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
										tooltip.classed("hidden", false)
											.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
											.html(function(){
												var per = d3.format(",.2%");
												var gd = d3.format("$,f");
												var pop = d3.format(",f");
												if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
												
											});
											
									  })
									  .on("mouseout", function (d) { 
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
										tooltip.classed("hidden", true);
									  });
									  circle.data(mynodes).sort(order);	
								}
								else{
									for (var i=0,j=data.length;i<j;i++){
										mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
										mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['edu']));
										mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['women'][0]));
									}
									//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									if(selectedColorMode=="c1"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									}
									else if(selectedColorMode=="c2"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
									}
									else if(selectedColorMode=="c3"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
									}
									else if(selectedColorMode=="c4"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
									}
									circle.on("mouseover", function (d,i) { 
										var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
										tooltip.classed("hidden", false)
											.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
											.html(function(){
												var per = d3.format(",.2%");
												var gd = d3.format("$,f");
												var pop = d3.format(",f");
												if (check_g==true){
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
												}
												else{
													return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
												}
												
											});
											
									})
									.on("mouseout", function (d) { 
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
										tooltip.classed("hidden", true);
									});
									circle.data(mynodes).sort(order);
								}
							}
							else if (select_x=="urb"){
								x = d3.scale.linear().domain([0.0, 1.00]).range([0, width-63]);
								xAxis = d3.svg.axis().scale(x).tickFormat(function(d, i){return formatPer0(d)+""}).tickValues([0,0.25,0.5,0.75]).orient("bottom");
								svg.select(".x.axis").remove();
								my_xaxis.remove();
								my_xaxis= svg.append("g")
									.attr("class", "x axis")
									.attr("transform", "translate("+50+"," +(height-50)+ ")")
									.call(xAxis)
									.append("text")
									.attr("x", 0)
									.attr("y", 0)
									.attr("dx", (width-60)+"px")
									.attr("dy", "-0.5em")
									.attr("font-size", "11px")
									.style("text-anchor", "end")
									.text("");
									
								if (check_g==true){
									for (var i=0,j=data.length;i<j;i++){
										mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
										mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['urb']));
										mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['men'][0]));
									}
									//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									if(selectedColorMode=="c1"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});									
									}
									else if(selectedColorMode=="c2"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
									}
									else if(selectedColorMode=="c3"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
									}
									else if(selectedColorMode=="c4"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
									}
									circle.on("mouseover", function (d,i) { 
										var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
										tooltip.classed("hidden", false)
											.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
											.html(function(){
												var per = d3.format(",.2%");
												var gd = d3.format("$,f");
												var pop = d3.format(",f");
												if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
												
											});
											
									  })
									  .on("mouseout", function (d) { 
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
										tooltip.classed("hidden", true);
									  });
									  circle.data(mynodes).sort(order);	
								}
								else{
									for (var i=0,j=data.length;i<j;i++){
										mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
										mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['urb']));
										mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['women'][0]));
									}
									//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									if(selectedColorMode=="c1"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});									
									}
									else if(selectedColorMode=="c2"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
									}
									else if(selectedColorMode=="c3"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
									}
									else if(selectedColorMode=="c4"){
										circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
									}
									circle.on("mouseover", function (d,i) { 
										var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
										tooltip.classed("hidden", false)
											.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
											.html(function(){
												var per = d3.format(",.2%");
												var gd = d3.format("$,f");
												var pop = d3.format(",f");
												if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
												
											});
											
									})
									.on("mouseout", function (d) { 
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
										tooltip.classed("hidden", true);
									});
									circle.data(mynodes).sort(order);
								}	
							}
						}
					
				});
					
				d3.select("#selectColor").on("change", function() { 
					//console.log(document.getElementById("selectColor").checked)
					var check_y = parseInt(slider.noUiSlider.get());
					var check_g = document.getElementById("selectGender").checked;
					var check_gr = document.getElementById("selectColor").checked
					if (check_gr==false){
						c2gradient="url(#gradient1)";
						c3gradient="url(#gradient2)";
						c4gradient="url(#gradient1)";
						mcolor = d3.scale.ordinal().domain(d3.range(9)).range(['#f69999' , '#e31e26', '#fdbf6e', '#f58022', '#b05828', '#6a3f97', '#2da147', '#a6cfe4' , '#1779b3']).domain(listMRegions);//d3.scale.category20();
						regioncolor = d3.scale.ordinal().range(['#f69999' , '#e31e26', '#fdbf6e', '#f58022', '#b05828', '#6a3f97', '#2da147', '#a6cfe4' , '#1779b3']).domain(listMRegions);
						range_c2=d3.scale.linear().domain([0.0,10.0, 20.0]).range(["red","#fee08b","green"]);
						range_c3=d3.scale.linear().domain([0.0,0.5,1.0]).range(["blue","#fee08b","red"]);//"#fee08b","red" ]);
						range_c4=d3.scale.linear().domain([0.0,20000, 200000]).range(["red","#fee08b","green"]);
						map_region_color = {"Sub-Saharan Africa":'#f69999',"Central Asia, Middle East and North Africa": '#e31e26',"South Asia": '#fdbf6e',"East and South East Asia": '#f58022',"High-income Asia Pacific": '#b05828',"Oceania": '#6a3f97',"Latin America and Caribbean": '#2da147',"High-income Western countries": '#a6cfe4' ,"Central and Eastern Europe": '#1779b3'}
					}
					else{
					
						c2gradient="url(#gradient1b)";
						c3gradient="url(#gradient2b)";
						c4gradient="url(#gradient1b)";
						regioncolor = d3.scale.ordinal().domain(d3.range(9)).range(['#8b0000','#c9314f','#ef738b','#ffb9bb','#ffffe0','#b1e6ae','#7ac696','#49a289','#008080']);
						mcolor = d3.scale.ordinal().range(['#8b0000','#c9314f','#ef738b','#ffb9bb','#ffffe0','#b1e6ae','#7ac696','#49a289','#008080']);
						range_c2=d3.scale.linear().domain([0.0,10.0, 20.0]).range(["hsl(33,87%,29%)" ,"hsl(0,0%,96%)","hsl(175,98%,20%)" ]);
						range_c3=d3.scale.linear().domain([0.0,0.5,1.0]).range(["hsl(175,98%,20%)" ,"hsl(0,0%,96%)","hsl(33,87%,29%)" ]);//"#fee08b","red" ]);
						range_c4=d3.scale.linear().domain([200,20000, 200000]).range(["hsl(33,87%,29%)" ,"hsl(0,0%,96%)","hsl(175,98%,20%)" ]);
						map_region_color ={"Sub-Saharan Africa":'#8b0000',"Central Asia, Middle East and North Africa": '#c9314f',"South Asia": '#ef738b',"East and South East Asia": '#ffb9bb',"High-income Asia Pacific": '#ffffe0',"Oceania": '#b1e6ae',"Latin America and Caribbean": '#7ac696',"High-income Western countries": '#49a289' ,"Central and Eastern Europe": '#008080'}
						
					}
					if(selectedColorMode=="c1"){
						circle.data(mynodes).transition().duration(200).style("fill", function (d,i) {return map_region_color[d.region];});
						legend_mreg.remove();
							legend_mreg = svg.append("g")
							.attr("class", "legend_mreg")
							.attr("x", 0)
							.attr("y", 25)
							.attr("height", 100)
							.attr("width", 100);
					
					
							//console.log(listMRegions)
							legend_mreg.selectAll('g').data(listMRegions)
							.enter()
							.append('g')
							.each(function(d, i) {
								var g = d3.select(this);
								var myx =(width*0.29)-150;
								var myy =20;
								
								myx =(width*0.55)-100
								myy =10;
								//if (!(document.getElementById("selectColor").checked)){
									g.append("rect")
									  .attr("x", (width *0.25)+((width *0.5)*0.111111*i))
									  .attr("y", (7))//.attr("y", (7))
									  .attr("width", (width *0.5)*0.111111)
									  .attr("height", 10)
									  .style("fill", function () {return regioncolor(d)})	
										.on("mouseover", function () { 
										var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
										//d3.select(this).style("stroke-width",20);
										tooltip.classed("hidden", false)
											.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+($('#graph-container').position().top+35)+"px")
											.html(function(){
												return d
												
											});
											
									  })
									  .on("mouseout", function () { 
										//if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
										tooltip.classed("hidden", true);
									  });
								//}
								

							});
						
						d3.selectAll(".legend_mreg").style("visibility","visible");
						d3.selectAll(".legend_edu").style("visibility","hidden");
						d3.selectAll(".legend_urb").style("visibility","hidden");
						d3.selectAll(".legend_gdp").style("visibility","hidden");
					}
					else if(selectedColorMode=="c2"){
						circle.data(mynodes).transition().duration(200).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
						legend_edu.remove();
						legend_edu = svg.append("g")
						.attr("class", "legend_edu")
						.attr("x", 0)
						.attr("y", 25)
						.attr("height", 100)
						.attr("width", 100);
						
						legend_edu.selectAll('g').data(["education"])
						.enter()
						.append('g')
						.each(function(d, i) {
							var g = d3.select(this);
							var myx =(width*0.29)-150;
							var myy =20;
							
							myx =(width*0.55)-100
							myy =10;
							
							g.append("rect")
							  .attr("x", (width *0.25))
							  .attr("y", (7))//.attr("y", (7))
							  .attr("width", (width *0.5))
							  .attr("height", 10)
							  .style("fill", c2gradient);	
							
							g.append("text")
							  .attr("x",(width *0.25)-5) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("0");
							 g.append("text")
							  .attr("x",(width *0.75)-20) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("20 years");

						});
						
						d3.selectAll(".legend_mreg").style("visibility","hidden");
						d3.selectAll(".legend_edu").style("visibility","visible");
						d3.selectAll(".legend_urb").style("visibility","hidden");
						d3.selectAll(".legend_gdp").style("visibility","hidden");
					}
					else if(selectedColorMode=="c3"){
						circle.data(mynodes).transition().duration(200).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});
						legend_urb.remove();
						legend_urb = svg.append("g")
						.attr("class", "legend_urb")
						.attr("x", 0)
						.attr("y", 25)
						.attr("height", 100)
						.attr("width", 100);
						
						legend_urb.selectAll('g').data(["urbanisation"])
						.enter()
						.append('g')
						.each(function(d, i) {
							var g = d3.select(this);
							var myx =(width*0.29)-150;
							var myy =20;
							
							myx =(width*0.55)-100
							myy =10;
							g.append("rect")
							  .attr("x", (width *0.25))
							  .attr("y", (7))//.attr("y", (7))
							  .attr("width", (width *0.5))
							  .attr("height", 10)
							  .style("fill", c3gradient);	
							//g.append("text")
							//  .attr("x",(width *0.25)-70) 
							//  .attr("y", 15)
							//  .attr("height",30)
							//  .attr("width",100)
							//  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							//  .style("font-size","small")
							//  .text(d);
							g.append("text")
							  .attr("x",(width *0.25)-7) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("0%");
							g.append("text")
							  .attr("x",(width *0.5)-10) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("50%");  
							g.append("text")
							  .attr("x",(width *0.75)-10) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("100%");

						});
								
						d3.selectAll(".legend_mreg").style("visibility","hidden");
						d3.selectAll(".legend_edu").style("visibility","hidden");
						d3.selectAll(".legend_urb").style("visibility","visible");
						d3.selectAll(".legend_gdp").style("visibility","hidden");
					}
					else if(selectedColorMode=="c4"){
						circle.data(mynodes).transition().duration(200).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});
						legend_gdp.remove();
						legend_gdp = svg.append("g")
						.attr("class", "legend_gdp")
						.attr("x", 0)
						.attr("y", 25)
						.attr("height", 100)
						.attr("width", 100);
						
						legend_gdp.selectAll('g').data(["gdp"])
						.enter()
						.append('g')
						.each(function(d, i) {
							var g = d3.select(this);
							var myx =(width*0.29)-150;
							var myy =20;
							
							myx =(width*0.55)-100
							myy =10;
							g.append("rect")
							  .attr("x", (width *0.25))
							  .attr("y", (7))//.attr("y", (7))
							  .attr("width", (width *0.5))
							  .attr("height", 10)
							  .style("fill", c2gradient);	
							//g.append("text")
							//  .attr("x",(width *0.25)-70) 
							//  .attr("y", 15)
							//  .attr("height",30)
							//  .attr("width",100)
							//  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							//  .style("font-size","small")
							//  .text(d);
							g.append("text")
							  .attr("x",(width *0.25)-17) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("$200");
							g.append("text")
							  .attr("x",(width *0.5)-22) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("$20,000");  
							g.append("text")
							  .attr("x",(width *0.75)-30) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("$200,000");

						});
						
						d3.selectAll(".legend_mreg").style("visibility","hidden");
						d3.selectAll(".legend_edu").style("visibility","hidden");
						d3.selectAll(".legend_urb").style("visibility","hidden");
						d3.selectAll(".legend_gdp").style("visibility","visible");						
					}
					
					//updateWindow();
					
				});
					
				var pauseValues = {
				  lastT: 1975,
				  currentT: 1975
				};
				
				d3.select("#playpause").on("click", function() {
					if (document.getElementById('playpause').className=='pause'){
						document.getElementById('playpause').className='play';
					}
					else{
						
						if (parseInt(slider.noUiSlider.get())==2014){
							pauseValues.currentT=1975;
							slider.noUiSlider.set(1975);
							
						}
						document.getElementById('playpause').className='pause';
						pauseValues.currentT = parseInt(slider.noUiSlider.get());
						one_step();
					}
				});
				
				function one_step(){
					if((pauseValues.currentT<2014) && (document.getElementById('playpause').className=='pause') ){
						setTimeout(function(){
							
							pauseValues.currentT++;
							slider.noUiSlider.set(parseInt(pauseValues.currentT));
							one_step();stepvalue();
							if (pauseValues.currentT>2014){d3.select('#playpause').attr('class','play');}
							}, 200)
					}
					else{
						document.getElementById('playpause').className='play';
					}
					
						
					
				}
					
				function stepvalue(){
					
					var check_y = parseInt(slider.noUiSlider.get());
					d3.select('#slidertext').text(parseInt(slider.noUiSlider.get()));
					var check_g = document.getElementById("selectGender").checked;
					var check_gr = document.getElementById("selectColor").checked;
					var s_g = document.getElementById("selectGraph").checked;
					var select_x =document.getElementById("x1").value;
					if(s_g==false){
						if (check_g==true){
						
							maxRadius=0;
							for (var i=0, j=data.length;i<j;i++){
								
								if (check_g==false){
									
									var tpp=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									if (maxRadius<tpp){
										maxRadius=tpp
									};
									
								}
								else{
									
									var tpp=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									if (maxRadius<tpp){
										maxRadius=tpp
									};
									
								}
								
							}
							for (var i=0,j=data.length;i<j;i++){
								
								mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
								//mynodes[i]['color']= mcolor(data[i].region);
							}
							 //circle
								///.each(gravity(.0))
								//.each(collide(.0))
								//.attr("cx", function(d) { return d.x; })
								//.attr("cy", function(d) { return d.y; });
							
							//circle.transition().duration(200).style("fill", function (d,i) {return map_region_color[d.region];});
							if(selectedColorMode=="c1"){
								circle.transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).style("fill", function (d,i) {return map_region_color[d.region];});
							}
							else if(selectedColorMode=="c2"){
								circle.transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});
							}
							else if(selectedColorMode=="c3"){
								circle.transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});
							}
							else if(selectedColorMode=="c4"){
								circle.transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});
							}
							
							
							circle.on("mouseover", function (d,i) { 
								var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
								if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
								tooltip.classed("hidden", false)
									.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
									.html(function(){
										var per = d3.format(",.2%");
										var gd = d3.format("$,f");
										var pop = d3.format(",f");
										if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
										
									});
									
							  })
							  .on("mouseout", function (d) { 
								if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
								tooltip.classed("hidden", true);
							  });
							//force.charge(0.7)
							force.resume();
						}
						else{
							maxRadius=0;
							for (var i=0, j=data.length;i<j;i++){
								
								if (check_g==false){
									
									var tpp=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									if (maxRadius<tpp){
										maxRadius=tpp
									};
									
								}
								else{
									
									var tpp=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									if (maxRadius<tpp){
										maxRadius=tpp
									};
									
								}
								
							}
							for (var i=0,j=data.length;i<j;i++){
								
								mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
								//mynodes[i]['color']= mcolor(data[i].region);
							}
							 //circle
								///.each(gravity(.0))
								//.each(collide(.0))
								//.attr("cx", function(d) { return d.x; })
								//.attr("cy", function(d) { return d.y; });
							
							//circle.transition().duration(200).style("fill", function (d,i) {return map_region_color[d.region];});
							if(selectedColorMode=="c1"){
								circle.transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).style("fill", function (d,i) {return map_region_color[d.region];});
							}
							else if(selectedColorMode=="c2"){
								circle.transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});
							}
							else if(selectedColorMode=="c3"){
								circle.transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});
							}
							else if(selectedColorMode=="c4"){
								circle.transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});
							}
							
							
							circle.on("mouseover", function (d,i) { 
								var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
								if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
								tooltip.classed("hidden", false)
									.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
									.html(function(){
										var per = d3.format(",.2%");
										var gd = d3.format("$,f");
										//var pop = d3.format(",f"); 
										if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
										
									});
									
							  })
							  .on("mouseout", function (d) { 
								if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
								tooltip.classed("hidden", true);
							  });
							force.resume();
						}
					}
					else{
						if (select_x=="gdp"){
								// x = d3.scale.pow().exponent(.5).domain([0, 200000]).range([0,width-51]);
								// xAxis = d3.svg.axis().scale(x).tickFormat(function(d, i){return formatGDP(d)+""}).tickValues([500,10000, 30000,60000,100000,160000]).orient("bottom");
								// svg.select(".x.axis").remove();
								// if (my_xaxis){
									// my_xaxis.remove();	
								// }
								// my_xaxis= svg.append("g")
									// .attr("class", "x axis")
									// .attr("transform", "translate("+50+"," +(height-50)+ ")")
									// .call(xAxis)
									// .append("text")
									// .attr("x", 0)
									// .attr("y", 0)
									// .attr("dx", (width-60)+"px")
									// .attr("dy", "-0.5em")
									// .attr("font-size", "11px")
									// .style("text-anchor", "end")
									// .text("");
								
								if (check_g==true){
									for (var i=0,j=data.length;i<j;i++){
										mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
										mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['gdp']));
										mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['men'][0]));
									}
									//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									if(selectedColorMode=="c1"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									}
									else if(selectedColorMode=="c2"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
									}
									else if(selectedColorMode=="c3"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
									}
									else if(selectedColorMode=="c4"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
									}
									circle.on("mouseover", function (d,i) { 
										var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
										tooltip.classed("hidden", false)
											.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
											.html(function(){
												var per = d3.format(",.2%");
												var gd = d3.format("$,f");
												var pop = d3.format(",f");
												if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
												
											});
											
									  })
									  .on("mouseout", function (d) { 
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
										tooltip.classed("hidden", true);
									  });
									  circle.data(mynodes).sort(order);	
								}
								else{
									for (var i=0,j=data.length;i<j;i++){
										mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
										mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['gdp']));
										mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['women'][0]));
									}
									//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									if(selectedColorMode=="c1"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									}
									else if(selectedColorMode=="c2"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
									}
									else if(selectedColorMode=="c3"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
									}
									else if(selectedColorMode=="c4"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
									}
									circle.on("mouseover", function (d,i) { 
										var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
										tooltip.classed("hidden", false)
											.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
											.html(function(){
												var per = d3.format(",.2%");
												var gd = d3.format("$,f");
												var pop = d3.format(",f");
												if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
												
											});
											
									})
									.on("mouseout", function (d) { 
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
										tooltip.classed("hidden", true);
									});
									circle.data(mynodes).sort(order);	
								}
							}
							else if (select_x=="edu"){
								// x = d3.scale.linear().domain([0, 15.0]).range([0, width-51]);
								// xAxis = d3.svg.axis().scale(x).tickFormat(function(d, i){return d+""}).tickValues([0,5,10]).orient("bottom");
								// svg.select(".x.axis").remove();
								// my_xaxis.remove();	
								// my_xaxis= svg.append("g")
									// .attr("class", "x axis")
									// .attr("transform", "translate("+50+"," +(height-50)+ ")")
									// .call(xAxis)
									// .append("text")
									// .attr("x", 0)
									// .attr("y", 0)
									// .attr("dx", (width-60)+"px")
									// .attr("dy", "-0.5em")
									// .attr("font-size", "11px")
									// .style("text-anchor", "end")
									// .text("");
								if (check_g==true){
									for (var i=0,j=data.length;i<j;i++){
										mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
										mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['edu']));
										mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['men'][0]));
									}
									//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									if(selectedColorMode=="c1"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									}
									else if(selectedColorMode=="c2"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
									}
									else if(selectedColorMode=="c3"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
									}
									else if(selectedColorMode=="c4"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
									}
									circle.on("mouseover", function (d,i) { 
										var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
										tooltip.classed("hidden", false)
											.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
											.html(function(){
												var per = d3.format(",.2%");
												var gd = d3.format("$,f");
												var pop = d3.format(",f");
												if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
												
											});
											
									  })
									  .on("mouseout", function (d) { 
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
										tooltip.classed("hidden", true);
									  });
									  circle.data(mynodes).sort(order);	
								}
								else{
									for (var i=0,j=data.length;i<j;i++){
										mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
										mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['edu']));
										mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['women'][0]));
									}
									//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									if(selectedColorMode=="c1"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									}
									else if(selectedColorMode=="c2"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
									}
									else if(selectedColorMode=="c3"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
									}
									else if(selectedColorMode=="c4"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
									}
									circle.on("mouseover", function (d,i) { 
										var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
										tooltip.classed("hidden", false)
											.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
											.html(function(){
												var per = d3.format(",.2%");
												var gd = d3.format("$,f");
												var pop = d3.format(",f");
												if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
												
											});
											
									})
									.on("mouseout", function (d) { 
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
										tooltip.classed("hidden", true);
									});
									circle.data(mynodes).sort(order);
								}
							}
							else if (select_x=="urb"){
								// x = d3.scale.linear().domain([0.0, 1.00]).range([0, width-63]);
								// xAxis = d3.svg.axis().scale(x).tickFormat(function(d, i){return formatPer0(d)+""}).tickValues([0,0.25,0.5,0.75]).orient("bottom");
								// svg.select(".x.axis").remove();
								// my_xaxis.remove();
								// my_xaxis= svg.append("g")
									// .attr("class", "x axis")
									// .attr("transform", "translate("+50+"," +(height-50)+ ")")
									// .call(xAxis)
									// .append("text")
									// .attr("x", 0)
									// .attr("y", 0)
									// .attr("dx", (width-60)+"px")
									// .attr("dy", "-0.5em")
									// .attr("font-size", "11px")
									// .style("text-anchor", "end")
									// .text("");
									
								if (check_g==true){
									for (var i=0,j=data.length;i<j;i++){
										mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
										mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['urb']));
										mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['men'][0]));
									}
									//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									if(selectedColorMode=="c1"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});									
									}
									else if(selectedColorMode=="c2"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
									}
									else if(selectedColorMode=="c3"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
									}
									else if(selectedColorMode=="c4"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
									}
									circle.on("mouseover", function (d,i) { 
										var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
										tooltip.classed("hidden", false)
											.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
											.html(function(){
												var per = d3.format(",.2%");
												var gd = d3.format("$,f");
												var pop = d3.format(",f");
												if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
												
											});
											
									  })
									  .on("mouseout", function (d) { 
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
										tooltip.classed("hidden", true);
									  });
									  circle.data(mynodes).sort(order);	
								}
								else{
									for (var i=0,j=data.length;i<j;i++){
										mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
										mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['urb']));
										mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['women'][0]));
									}
									//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									if(selectedColorMode=="c1"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});									
									}
									else if(selectedColorMode=="c2"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
									}
									else if(selectedColorMode=="c3"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
									}
									else if(selectedColorMode=="c4"){
										circle.data(mynodes).transition().duration(195).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
									}
									circle.on("mouseover", function (d,i) { 
										var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
										tooltip.classed("hidden", false)
											.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
											.html(function(){
												var per = d3.format(",.2%");
												var gd = d3.format("$,f");
												var pop = d3.format(",f");
												if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
												
											});
											
									})
									.on("mouseout", function (d) { 
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
										tooltip.classed("hidden", true);
									});
									circle.data(mynodes).sort(order);
								}	
							}
					}
				}
				

				d3.select("#optlist").on("change", function() {
				//function getSelectedOptions(sel) {
					listOptions=[];
					  var opts = [],
						opt;
						var sel =this;
					  var len = sel.options.length;
					  for (var i = 0; i < len; i++) {
						opt = sel.options[i];

						if (opt.selected) {
						  opts.push(opt);
						  listOptions.push(opt.text)
						  
						}
					  }
					  //console.log(listOptions)
					if (isIE){
						refreshG();
					}
					return opts;
				//}
				});

				
				//console.log(d3.select("#red"))
				//$( "#red" ).slider().on("slide", function (e, ui) {	
				slider.noUiSlider.on('update', function(){		
					d3.select('#slidertext').text(parseInt(slider.noUiSlider.get()));
					var check_y = parseInt(slider.noUiSlider.get());
					pauseValues.currentT = parseInt(slider.noUiSlider.get());
					var check_g = document.getElementById("selectGender").checked;
					var check_gr = document.getElementById("selectColor").checked;
					var s_g = document.getElementById("selectGraph").checked;
					var select_x =document.getElementById("x1").value;
					if(s_g==false){
						if (check_g==true){
						
							maxRadius=0;
							for (var i=0, j=data.length;i<j;i++){
								
								if (check_g==false){
									
									var tpp=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									if (maxRadius<tpp){
										maxRadius=tpp
									};
									
								}
								else{
									
									var tpp=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									if (maxRadius<tpp){
										maxRadius=tpp
									};
									
								}
								
							}
							for (var i=0,j=data.length;i<j;i++){
								
								mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
								//mynodes[i]['color']= mcolor(data[i].region);
							}
							 //circle
								///.each(gravity(.0))
								//.each(collide(.0))
								//.attr("cx", function(d) { return d.x; })
								//.attr("cy", function(d) { return d.y; });
							
							//circle.transition().duration(200).style("fill", function (d,i) {return map_region_color[d.region];});
							if(selectedColorMode=="c1"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).style("fill", function (d,i) {return map_region_color[d.region];});
							}
							else if(selectedColorMode=="c2"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});
							}
							else if(selectedColorMode=="c3"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});
							}
							else if(selectedColorMode=="c4"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});
							}
							
							
							circle.on("mouseover", function (d,i) { 
								var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
								if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
								tooltip.classed("hidden", false)
									.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
									.html(function(){
										var per = d3.format(",.2%");
										var gd = d3.format("$,f");
										var pop = d3.format(",f");
										if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
										
									});
									
							  })
							  .on("mouseout", function (d) { 
								if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
								tooltip.classed("hidden", true);
							  });
							//force.charge(0.7)
							force.resume();
						}
						else{
							maxRadius=0;
							for (var i=0, j=data.length;i<j;i++){
								
								if (check_g==false){
									
									var tpp=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									if (maxRadius<tpp){
										maxRadius=tpp
									};
									
								}
								else{
									
									var tpp=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									if (maxRadius<tpp){
										maxRadius=tpp
									};
									
								}
								
							}
							for (var i=0,j=data.length;i<j;i++){
								
								mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
								//mynodes[i]['color']= mcolor(data[i].region);
							}
							 //circle
								///.each(gravity(.0))
								//.each(collide(.0))
								//.attr("cx", function(d) { return d.x; })
								//.attr("cy", function(d) { return d.y; });
							
							//circle.transition().duration(200).style("fill", function (d,i) {return map_region_color[d.region];});
							if(selectedColorMode=="c1"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).style("fill", function (d,i) {return map_region_color[d.region];});
							}
							else if(selectedColorMode=="c2"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});
							}
							else if(selectedColorMode=="c3"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});
							}
							else if(selectedColorMode=="c4"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});
							}
							
							
							circle.on("mouseover", function (d,i) { 
								var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
								if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
								tooltip.classed("hidden", false)
									.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
									.html(function(){
										var per = d3.format(",.2%");
										var gd = d3.format("$,f");
										//var pop = d3.format(",f"); 
										if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
										
									});
									
							  })
							  .on("mouseout", function (d) { 
								if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
								tooltip.classed("hidden", true);
							  });
							force.resume();
						}
					}
					else{
						if (select_x=="gdp"){
								// x = d3.scale.pow().exponent(.5).domain([0, 200000]).range([0,width-51]);
								// xAxis = d3.svg.axis().scale(x).tickFormat(function(d, i){return formatGDP(d)+""}).tickValues([500,10000, 30000,60000,100000,160000]).orient("bottom");
								// svg.select(".x.axis").remove();
								// if (my_xaxis){
									// my_xaxis.remove();	
								// }
								// my_xaxis= svg.append("g")
									// .attr("class", "x axis")
									// .attr("transform", "translate("+50+"," +(height-50)+ ")")
									// .call(xAxis)
									// .append("text")
									// .attr("x", 0)
									// .attr("y", 0)
									// .attr("dx", (width-60)+"px")
									// .attr("dy", "-0.5em")
									// .attr("font-size", "11px")
									// .style("text-anchor", "end")
									// .text("");
								
								if (check_g==true){
									for (var i=0,j=data.length;i<j;i++){
										mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
										mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['gdp']));
										mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['men'][0]));
									}
									//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									if(selectedColorMode=="c1"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									}
									else if(selectedColorMode=="c2"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
									}
									else if(selectedColorMode=="c3"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
									}
									else if(selectedColorMode=="c4"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
									}
									circle.on("mouseover", function (d,i) { 
										var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
										tooltip.classed("hidden", false)
											.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
											.html(function(){
												var per = d3.format(",.2%");
												var gd = d3.format("$,f");
												var pop = d3.format(",f");
												if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
												
											});
											
									  })
									  .on("mouseout", function (d) { 
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
										tooltip.classed("hidden", true);
									  });
									  circle.data(mynodes).sort(order);	
								}
								else{
									for (var i=0,j=data.length;i<j;i++){
										mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
										mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['gdp']));
										mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['women'][0]));
									}
									//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									if(selectedColorMode=="c1"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									}
									else if(selectedColorMode=="c2"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
									}
									else if(selectedColorMode=="c3"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
									}
									else if(selectedColorMode=="c4"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
									}
									circle.on("mouseover", function (d,i) { 
										var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
										tooltip.classed("hidden", false)
											.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
											.html(function(){
												var per = d3.format(",.2%");
												var gd = d3.format("$,f");
												var pop = d3.format(",f");
												if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
												
											});
											
									})
									.on("mouseout", function (d) { 
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
										tooltip.classed("hidden", true);
									});
									circle.data(mynodes).sort(order);	
								}
							}
							else if (select_x=="edu"){
								// x = d3.scale.linear().domain([0, 15.0]).range([0, width-51]);
								// xAxis = d3.svg.axis().scale(x).tickFormat(function(d, i){return d+""}).tickValues([0,5,10]).orient("bottom");
								// svg.select(".x.axis").remove();
								// my_xaxis.remove();	
								// my_xaxis= svg.append("g")
									// .attr("class", "x axis")
									// .attr("transform", "translate("+50+"," +(height-50)+ ")")
									// .call(xAxis)
									// .append("text")
									// .attr("x", 0)
									// .attr("y", 0)
									// .attr("dx", (width-60)+"px")
									// .attr("dy", "-0.5em")
									// .attr("font-size", "11px")
									// .style("text-anchor", "end")
									// .text("");
								if (check_g==true){
									for (var i=0,j=data.length;i<j;i++){
										mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
										mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['edu']));
										mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['men'][0]));
									}
									//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									if(selectedColorMode=="c1"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									}
									else if(selectedColorMode=="c2"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
									}
									else if(selectedColorMode=="c3"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
									}
									else if(selectedColorMode=="c4"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
									}
									circle.on("mouseover", function (d,i) { 
										var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
										tooltip.classed("hidden", false)
											.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
											.html(function(){
												var per = d3.format(",.2%");
												var gd = d3.format("$,f");
												var pop = d3.format(",f");
												if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
												
											});
											
									  })
									  .on("mouseout", function (d) { 
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
										tooltip.classed("hidden", true);
									  });
									  circle.data(mynodes).sort(order);	
								}
								else{
									for (var i=0,j=data.length;i<j;i++){
										mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
										mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['edu']));
										mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['women'][0]));
									}
									//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									if(selectedColorMode=="c1"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									}
									else if(selectedColorMode=="c2"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
									}
									else if(selectedColorMode=="c3"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
									}
									else if(selectedColorMode=="c4"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
									}
									circle.on("mouseover", function (d,i) { 
										var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
										tooltip.classed("hidden", false)
											.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
											.html(function(){
												var per = d3.format(",.2%");
												var gd = d3.format("$,f");
												var pop = d3.format(",f");
												if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
												
											});
											
									})
									.on("mouseout", function (d) { 
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
										tooltip.classed("hidden", true);
									});
									circle.data(mynodes).sort(order);
								}
							}
							else if (select_x=="urb"){
								// x = d3.scale.linear().domain([0.0, 1.00]).range([0, width-63]);
								// xAxis = d3.svg.axis().scale(x).tickFormat(function(d, i){return formatPer0(d)+""}).tickValues([0,0.25,0.5,0.75]).orient("bottom");
								// svg.select(".x.axis").remove();
								// my_xaxis.remove();
								// my_xaxis= svg.append("g")
									// .attr("class", "x axis")
									// .attr("transform", "translate("+50+"," +(height-50)+ ")")
									// .call(xAxis)
									// .append("text")
									// .attr("x", 0)
									// .attr("y", 0)
									// .attr("dx", (width-60)+"px")
									// .attr("dy", "-0.5em")
									// .attr("font-size", "11px")
									// .style("text-anchor", "end")
									// .text("");
									
								if (check_g==true){
									for (var i=0,j=data.length;i<j;i++){
										mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
										mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['urb']));
										mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['men'][0]));
									}
									//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									if(selectedColorMode=="c1"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});									
									}
									else if(selectedColorMode=="c2"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
									}
									else if(selectedColorMode=="c3"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
									}
									else if(selectedColorMode=="c4"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
									}
									circle.on("mouseover", function (d,i) { 
										var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
										tooltip.classed("hidden", false)
											.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
											.html(function(){
												var per = d3.format(",.2%");
												var gd = d3.format("$,f");
												var pop = d3.format(",f");
												if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
												
											});
											
									  })
									  .on("mouseout", function (d) { 
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
										tooltip.classed("hidden", true);
									  });
									  circle.data(mynodes).sort(order);	
								}
								else{
									for (var i=0,j=data.length;i<j;i++){
										mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
										mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['urb']));
										mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['women'][0]));
									}
									//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
									if(selectedColorMode=="c1"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});									
									}
									else if(selectedColorMode=="c2"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
									}
									else if(selectedColorMode=="c3"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
									}
									else if(selectedColorMode=="c4"){
										circle.data(mynodes).transition().duration(80).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
									}
									circle.on("mouseover", function (d,i) { 
										var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
										tooltip.classed("hidden", false)
											.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
											.html(function(){
												var per = d3.format(",.2%");
												var gd = d3.format("$,f");
												var pop = d3.format(",f");
												if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
												
											});
											
									})
									.on("mouseout", function (d) { 
										if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
										tooltip.classed("hidden", true);
									});
									circle.data(mynodes).sort(order);
								}	
							}
					}
				});
					
					
				// resise window	
				window.onresize = updateWindow;
				
				function updateWindow(){
					 width = 630;//width = ((window.innerWidth*0.99)-261);//document.getElementById('graph-container').offsetWidth;
					height=width*0.6;
					svg.attr("width", width).attr("height", height);
					var check_g = document.getElementById("selectGender").checked;
					var check_gr = document.getElementById("selectColor").checked;
					var s_g = document.getElementById("selectGraph").checked;
					var select_x =document.getElementById("x1").value;
					var check_y = parseInt(slider.noUiSlider.get());
					d3.select('#slidertext').text(parseInt(slider.noUiSlider.get()));
					document.getElementById('red').style.width=((width-30))+"px";
					//document.getElementById('optlist').style.height=(height/2)+"px";
					radius_scale = radius_scale = d3.scale.linear().domain([0, max_amount]).range([2,  2+(Math.min(width,height)/8)]);//d3.scale.pow(3).domain([0, max_amount]).range([2, 2+(Math.min(width,height)/30)]);
					if(selectedColorMode=="c1"){
						
						
							legend_mreg.remove();
							legend_mreg = svg.append("g")
							.attr("class", "legend_mreg")
							.attr("x", 0)
							.attr("y", 25)
							.attr("height", 100)
							.attr("width", 100);
					
					
							//console.log(listMRegions)
							legend_mreg.selectAll('g').data(listMRegions)
							.enter()
							.append('g')
							.each(function(d, i) {
								var g = d3.select(this);
								var myx =(width*0.29)-150;
								var myy =20;
								
								myx =(width*0.55)-100
								myy =10;
								//if (!(document.getElementById("selectColor").checked)){
									g.append("rect")
									  .attr("x", (width *0.25)+((width *0.5)*0.111111*i))
									  .attr("y", (7))//.attr("y", (7))
									  .attr("width", (width *0.5)*0.111111)
									  .attr("height", 10)
									  .style("fill", function () {return regioncolor(d)})	
										.on("mouseover", function () { 
										var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
										//d3.select(this).style("stroke-width",20);
										tooltip.classed("hidden", false)
											.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+($('#graph-container').position().top+35)+"px")
											.html(function(){
												return d
												
											});
											
									  })
									  .on("mouseout", function () { 
										//if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
										tooltip.classed("hidden", true);
									  });
								//}
								

							});
						
						d3.selectAll(".legend_mreg").style("visibility","visible");
						d3.selectAll(".legend_edu").style("visibility","hidden");
						d3.selectAll(".legend_urb").style("visibility","hidden");
						d3.selectAll(".legend_gdp").style("visibility","hidden");
					}
					else if(selectedColorMode=="c2"){
						
						
						legend_edu.remove();
						legend_edu = svg.append("g")
						.attr("class", "legend_edu")
						.attr("x", 0)
						.attr("y", 25)
						.attr("height", 100)
						.attr("width", 100);
						
						legend_edu.selectAll('g').data(["education"])
						.enter()
						.append('g')
						.each(function(d, i) {
							var g = d3.select(this);
							var myx =(width*0.29)-150;
							var myy =20;
							
							myx =(width*0.55)-100
							myy =10;
							
							g.append("rect")
							  .attr("x", (width *0.25))
							  .attr("y", (7))//.attr("y", (7))
							  .attr("width", (width *0.5))
							  .attr("height", 10)
							  .style("fill", c2gradient);	
							
							g.append("text")
							  .attr("x",(width *0.25)-5) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("0");
							 g.append("text")
							  .attr("x",(width *0.75)-20) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("20 years");

						});
						
						d3.selectAll(".legend_mreg").style("visibility","hidden");
						d3.selectAll(".legend_edu").style("visibility","visible");
						d3.selectAll(".legend_urb").style("visibility","hidden");
						d3.selectAll(".legend_gdp").style("visibility","hidden");
					}
					else if(selectedColorMode=="c3"){
						
						legend_urb.remove();
						legend_urb = svg.append("g")
						.attr("class", "legend_urb")
						.attr("x", 0)
						.attr("y", 25)
						.attr("height", 100)
						.attr("width", 100);
						
						legend_urb.selectAll('g').data(["urbanisation"])
						.enter()
						.append('g')
						.each(function(d, i) {
							var g = d3.select(this);
							var myx =(width*0.29)-150;
							var myy =20;
							
							myx =(width*0.55)-100
							myy =10;
							g.append("rect")
							  .attr("x", (width *0.25))
							  .attr("y", (7))//.attr("y", (7))
							  .attr("width", (width *0.5))
							  .attr("height", 10)
							  .style("fill", c3gradient);	
							//g.append("text")
							//  .attr("x",(width *0.25)-70) 
							//  .attr("y", 15)
							//  .attr("height",30)
							//  .attr("width",100)
							//  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							//  .style("font-size","small")
							//  .text(d);
							g.append("text")
							  .attr("x",(width *0.25)-7) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("0%");
							g.append("text")
							  .attr("x",(width *0.5)-10) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("50%");  
							g.append("text")
							  .attr("x",(width *0.75)-10) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("100%");

						});
								
						d3.selectAll(".legend_mreg").style("visibility","hidden");
						d3.selectAll(".legend_edu").style("visibility","hidden");
						d3.selectAll(".legend_urb").style("visibility","visible");
						d3.selectAll(".legend_gdp").style("visibility","hidden");
					}
					else if(selectedColorMode=="c4"){
						
						legend_gdp.remove();
						legend_gdp = svg.append("g")
						.attr("class", "legend_gdp")
						.attr("x", 0)
						.attr("y", 25)
						.attr("height", 100)
						.attr("width", 100);
						
						legend_gdp.selectAll('g').data(["gdp"])
						.enter()
						.append('g')
						.each(function(d, i) {
							var g = d3.select(this);
							var myx =(width*0.29)-150;
							var myy =20;
							
							myx =(width*0.55)-100
							myy =10;
							g.append("rect")
							  .attr("x", (width *0.25))
							  .attr("y", (7))//.attr("y", (7))
							  .attr("width", (width *0.5))
							  .attr("height", 10)
							  .style("fill", c2gradient);	
							//g.append("text")
							//  .attr("x",(width *0.25)-70) 
							//  .attr("y", 15)
							//  .attr("height",30)
							//  .attr("width",100)
							//  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							//  .style("font-size","small")
							//  .text(d);
							g.append("text")
							  .attr("x",(width *0.25)-17) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("$200");
							g.append("text")
							  .attr("x",(width *0.5)-22) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("$20,000");  
							g.append("text")
							  .attr("x",(width *0.75)-30) 
							  .attr("y", 30)
							  .attr("height",30)
							  .attr("width",100)
							  .style("fill", "gray").style("font-weight", "bold")//.style("font-style", "italic")
							  .style("font-size","small")
							  .text("$200,000");

						});
						
						d3.selectAll(".legend_mreg").style("visibility","hidden");
						d3.selectAll(".legend_edu").style("visibility","hidden");
						d3.selectAll(".legend_urb").style("visibility","hidden");
						d3.selectAll(".legend_gdp").style("visibility","visible");
					}
					if(s_g==false){
					
					
					
					
					
					all_center = { "all": {name:"all", x: (width/2), y: (height/2)}};
					
					//force.stop()
					
					maxRadius=0;
					padding_border=35;
					for (var i=0, j=data.length;i<j;i++){
						data[i].x=_.random(padding_border, width-padding_border);
						data[i].y=_.random(padding_border, height-padding_border);
						if (check_g==false){
							if (data[i]['timedata'][parseInt(check_y)-1975]){
							data[i].radius=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
							if (maxRadius<data[i].radius){maxRadius=data[i].radius};}
							
						}
						else{
							if(data[i]['timedata'][parseInt(check_y)-1975]){
							data[i].radius=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
							if (maxRadius<data[i].radius){maxRadius=data[i].radius};
							}
						}
						
					}
					padding = 3;
				
					
					
					
					foci={}
					centers = getCenters(selectedMode, [width, height-35]);
					for (var i = 0; i < centers.length; i++) {
					 foci[centers[i].name] = centers[i];
					}
					for (var i=0,j=data.length;i<j;i++){
						var mcx;
						var mcy;
						if(selectedMode=="all"){
							var f = foci[data[i][selectedMode]];
							mcx= (f.dx / 2);
							mcy= (f.dy / 2);
						}
						
						if(selectedMode!="all"){
							var f = foci[mynodes[i]["region"]];
							mcx = f.x+(f.dx/2);
							mcy = f.y+(f.dy/2);
						}
						
						mynodes[i]['cx']=mcx ; 
						mynodes[i]['cy']=mcy;
						mynodes[i]['radius']=data[i].radius;
						
					}
					
					if(selectedMode!="all"){
						
						
						d3.selectAll("rect").data(centers).transition().duration(0).attr("x", function (d) { return d.x; })
							.attr("y", function (d) { return d.y+35; })
							.attr("width", function (d) { return (d.dx); })
							.attr("height", function (d) { return (d.dy); });
							
							
						
						
						svg.selectAll("text").data(centers).transition().duration(0).text(function (d,i) { if((d.name.length*5.5 )> d.dx){ return d.name.substring(0,(parseInt(d.dx/5.5 )))+'...';} else {return d.name; }})
							.attr("x", function (d) { return d.x; })
							.attr("y", function (d) { return d.y+35; })
							.attr("dy", function (d) { return 15; })
					}		
					//force.stop();
					//force.resume();	
					
					
					
					//if (check_gr==false){
						if (check_g==true){
						
							maxRadius=0;
							for (var i=0, j=data.length;i<j;i++){
								
								if (check_g==false){
									
									var tpp=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									if (maxRadius<tpp){
										maxRadius=tpp
									};
									
								}
								else{
									
									var tpp=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									if (maxRadius<tpp){
										maxRadius=tpp
									};
									
								}
								
							}
							for (var i=0,j=data.length;i<j;i++){
								
								mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
								//mynodes[i]['color']= mcolor(data[i].region);
							}
							 //circle
								///.each(gravity(.0))
								//.each(collide(.0))
								//.attr("cx", function(d) { return d.x; })
								//.attr("cy", function(d) { return d.y; });
							
							//circle.transition().duration(200).style("fill", function (d,i) {return map_region_color[d.region];});
							if(selectedColorMode=="c1"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).style("fill", function (d,i) {return mcolor(i);});
							}
							else if(selectedColorMode=="c2"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});
							}
							else if(selectedColorMode=="c3"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});
							}
							else if(selectedColorMode=="c4"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});
							}
							
							
							circle.on("mouseover", function (d,i) { 
								var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
								if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
								tooltip.classed("hidden", false)
									.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
									.html(function(){
										var per = d3.format(",.2%");
										var gd = d3.format("$,f");
										var pop = d3.format(",f"); 
										if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
										
									});
									
							  })
							  .on("mouseout", function (d) { 
								if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
								tooltip.classed("hidden", true);
							  });
							//force.charge(0.7)
							force.resume();
						}
						else{
							maxRadius=0;
							for (var i=0, j=data.length;i<j;i++){
								
								if (check_g==false){
									
									var tpp=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									if (maxRadius<tpp){
										maxRadius=tpp
									};
									
								}
								else{
									
									var tpp=radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									if (maxRadius<tpp){
										maxRadius=tpp
									};
									
								}
								
							}
							for (var i=0,j=data.length;i<j;i++){
								
								mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
								//mynodes[i]['color']= mcolor(data[i].region);
							}
							 //circle
								///.each(gravity(.0))
								//.each(collide(.0))
								//.attr("cx", function(d) { return d.x; })
								//.attr("cy", function(d) { return d.y; });
							
							//circle.transition().duration(200).style("fill", function (d,i) {return map_region_color[d.region];});
							if(selectedColorMode=="c1"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).style("fill", function (d,i) {return map_region_color[d.region];});
							}
							else if(selectedColorMode=="c2"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});
							}
							else if(selectedColorMode=="c3"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});
							}
							else if(selectedColorMode=="c4"){
								circle.transition().duration(0).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});
							}
							
							
							circle.on("mouseover", function (d,i) { 
								var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
								if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
								tooltip.classed("hidden", false)
									.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
									.html(function(){
										var per = d3.format(",.2%");
										var gd = d3.format("$,f");
										//var pop = d3.format(",f");
										if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
										
									});
									
							  })
							  .on("mouseout", function (d) { 
								if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
								tooltip.classed("hidden", true);
							  });
							//force.charge(0.7)
							force.resume();
						}
					}
					else{
						if (select_x=="gdp"){
							x = d3.scale.pow().exponent(.5).domain([0, 200000]).range([0,width-51]);
							xAxis = d3.svg.axis().scale(x).tickFormat(function(d, i){return formatGDP(d)+""}).tickValues([500,10000, 30000,60000,100000,160000]).orient("bottom");
							svg.select(".x.axis").remove();
							if (my_xaxis){
								my_xaxis.remove();	
							}
							my_xaxis= svg.append("g")
								.attr("class", "x axis")
								.attr("transform", "translate("+50+"," +(height-50)+ ")")
								.call(xAxis)
								.append("text")
								.attr("x", 0)
								.attr("y", 0)
								.attr("dx", (width-60)+"px")
								.attr("dy", "-0.5em")
								.attr("font-size", "11px")
								.style("text-anchor", "end")
								.text("");
							y = d3.scale.linear().domain([0, 0.6]).range([height-50,30]);
							yAxis = d3.svg.axis().scale(y).tickFormat(function(d, i){return formatPer0(d)+""}).tickValues([0,0.2, 0.4,0.6]).orient("left");
							svg.select(".y.axis").remove();
							if (my_yaxis){
								my_yaxis.remove();	
							}
							my_yaxis= svg.append("g")
								.attr("class", "y axis")
								.attr("transform", "translate("+50+"," + (0)+ ")")
								.call(yAxis)
								.append("text")
								.attr("transform", "rotate(-90)")
								.attr("y", 6)
								.attr("x", -30)
								.attr("dy", ".71em")
								.attr("dx", "-0.25em")
								.attr("font-size", "11px")
								.style("text-anchor", "end")
								.text("Prevalence");	
							if (check_g==true){
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['gdp']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['men'][0]));
								}
								//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								  })
								  .on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								  });
								  circle.data(mynodes).sort(order);	
							}
							else{
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['gdp']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['women'][0]));
								}
								//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								})
								.on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								});
								circle.data(mynodes).sort(order);	
							}
						}
						else if (select_x=="edu"){
							x = d3.scale.linear().domain([0, 15.0]).range([0, width-51]);
							xAxis = d3.svg.axis().scale(x).tickFormat(function(d, i){if (d==0){ return d+" years"} else {return d+""}}).tickValues([0,5,10]).orient("bottom");
							svg.select(".x.axis").remove();
							my_xaxis.remove();	
							my_xaxis= svg.append("g")
								.attr("class", "x axis")
								.attr("transform", "translate("+50+"," +(height-50)+ ")")
								.call(xAxis)
								.append("text")
								.attr("x", 0)
								.attr("y", 0)
								.attr("dx", (width-60)+"px")
								.attr("dy", "-0.5em")
								.attr("font-size", "11px")
								.style("text-anchor", "end")
								.text("");
							y = d3.scale.linear().domain([0, 0.6]).range([height-50,30]);
							yAxis = d3.svg.axis().scale(y).tickFormat(function(d, i){return formatPer0(d)+""}).tickValues([0,0.2, 0.4,0.6]).orient("left");
							svg.select(".y.axis").remove();
							if (my_yaxis){
								my_yaxis.remove();	
							}
							my_yaxis= svg.append("g")
								.attr("class", "y axis")
								.attr("transform", "translate("+50+"," + (0)+ ")")
								.call(yAxis)
								.append("text")
								.attr("transform", "rotate(-90)")
								.attr("y", 6)
								.attr("x", -30)
								.attr("dy", ".71em")
								.attr("dx", "-0.25em")
								.attr("font-size", "11px")
								.style("text-anchor", "end")
								.text("Prevalence");	
							if (check_g==true){
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['edu']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['men'][0]));
								}
								//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								  })
								  .on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								  });
								  circle.data(mynodes).sort(order);	
							}
							else{
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['edu']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['women'][0]));
								}
								//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								})
								.on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								});
								circle.data(mynodes).sort(order);
							}
						}
						else if (select_x=="urb"){
							x = d3.scale.linear().domain([0.0, 1.00]).range([0, width-63]);
							xAxis = d3.svg.axis().scale(x).tickFormat(function(d, i){return formatPer0(d)+""}).tickValues([0,0.25,0.5,0.75]).orient("bottom");
							svg.select(".x.axis").remove();
							my_xaxis.remove();
							my_xaxis= svg.append("g")
								.attr("class", "x axis")
								.attr("transform", "translate("+50+"," +(height-50)+ ")")
								.call(xAxis)
								.append("text")
								.attr("x", 0)
								.attr("y", 0)
								.attr("dx", (width-60)+"px")
								.attr("dy", "-0.5em")
								.attr("font-size", "11px")
								.style("text-anchor", "end")
								.text("");
							y = d3.scale.linear().domain([0, 0.6]).range([height-50,30]);
							yAxis = d3.svg.axis().scale(y).tickFormat(function(d, i){return formatPer0(d)+""}).tickValues([0,0.2, 0.4,0.6]).orient("left");
							svg.select(".y.axis").remove();
							if (my_yaxis){
								my_yaxis.remove();	
							}
							my_yaxis= svg.append("g")
								.attr("class", "y axis")
								.attr("transform", "translate("+50+"," + (0)+ ")")
								.call(yAxis)
								.append("text")
								.attr("transform", "rotate(-90)")
								.attr("y", 6)
								.attr("x", -30)
								.attr("dy", ".71em")
								.attr("dx", "-0.25em")
								.attr("font-size", "11px")
								.style("text-anchor", "end")
								.text("Prevalence");		
							if (check_g==true){
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['urb']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['men'][0]));
								}
								//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});									
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['men'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								  })
								  .on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								  });
								  circle.data(mynodes).sort(order);	
							}
							else{
								for (var i=0,j=data.length;i<j;i++){
									mynodes[i]['radius']= radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]);
									mynodes[i]['cx']= x(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['urb']));
									mynodes[i]['cy']= y(parseFloat(data[i]['timedata'][parseInt(check_y)-1975]['women'][0]));
								}
								//circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});
								if(selectedColorMode=="c1"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return map_region_color[d.region];});									
								}
								else if(selectedColorMode=="c2"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c2(data[i]['timedata'][parseInt(check_y)-1975]['edu']);});									
								}
								else if(selectedColorMode=="c3"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c3((data[i]['timedata'][parseInt(check_y)-1975]['urb']));});									
								}
								else if(selectedColorMode=="c4"){
									circle.data(mynodes).transition().duration(200).attr("r", function (d,i) {return radius_scale(data[i]['timedata'][parseInt(check_y)-1975]['women'][1]); }).attr("cx", function(d) { return 50+d.cx; }).attr("cy", function(d) { return d.cy; }).style("fill", function (d,i) {return range_c4(data[i]['timedata'][parseInt(check_y)-1975]['gdp']);});									
								}
								circle.on("mouseover", function (d,i) { 
									var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",true);}
									tooltip.classed("hidden", false)
										.attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+$('#graph-container').position().top-35)+"px")
										.html(function(){
											var per = d3.format(",.2%");
											var gd = d3.format("$,f");
											var pop = d3.format(",f");
											if (check_g==true){
											return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['men'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['men'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											else{
												return "<b>"+d.name+"</b></br>Number of underweight people:</br><b>"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][1])+"</b> ("+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][2])+"-"+formatPop(data[i]['timedata'][parseInt(check_y)-1975]['women'][3])+")</br>Prevalence:</br><b>"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][0])+"</b> ("+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][4])+"-"+formatPer(data[i]['timedata'][parseInt(check_y)-1975]['women'][5])+")";//</br>education "+data[i]['timedata'][parseInt(check_y)-1975]['edu'].toFixed(0)+" years</br>urbanisation "+per(data[i]['timedata'][parseInt(check_y)-1975]['urb'])+"</br>gdp "+gd(data[i]['timedata'][parseInt(check_y)-1975]['gdp'])
											}
											
										});
										
								})
								.on("mouseout", function (d) { 
									if (d3.select(this).classed("normal")){d3.select(this).classed("unselected-underlined",false);} 
									tooltip.classed("hidden", true);
								});
								circle.data(mynodes).sort(order);
							}	
						}
						////////////////////////////////	
						var matrix = my_xaxis[0][0].getScreenCTM();
						$('#x1').css('left',410)
				$('#x1').css('top',398)
						////////////////////////////////
					}
					
				}
				
				function refreshG(){
		
					//console.log(listOptions)
					circle.transition().duration(0).attr("class", function (d,i) {if (listOptions.indexOf(data[i]['name'])>-1) {return "underlined";}else{return "normal"}});
					
				}
				
			//});					
		});	
	//});
});
	




//function playpause() {
	
//}


function move() {

  var t = d3.event.translate;
  var s = d3.event.scale; 
  zscale = s;
  var h = height/4;


  t[0] = Math.min(
    (width/height)  * (s - 1), 
    Math.max( width * (1 - s), t[0] )
  );

  t[1] = Math.min(
    h * (s - 1) + h * s, 
    Math.max(height  * (1 - s) - h * s, t[1])
  );

  zoom.translate(t);
  //mg.attr("transform", "translate(" + t + ")scale(" + s + ")");
	scalezoom=s;
  //adjust the country hover stroke width based on zoom level
 // d3.selectAll(".country").style("stroke-width", function (d,i) {if(i==highlightedcountry) {return (1.3/s)} else {return (0.3/s)}});

}




</script>

    </body>
</html>
